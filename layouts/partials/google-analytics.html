{{ with site.Params.googleAnalytics }}
<!-- Google tag (gtag.js) â€” deferred until idle to reduce TBT -->
<script>
  function _loadGA() {
    var s = document.createElement('script');
    s.src = 'https://www.googletagmanager.com/gtag/js?id={{ . }}';
    s.async = true;
    document.head.appendChild(s);
    s.onload = function() {
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', '{{ . }}');
      window.gtag = gtag;
    };
  }
  if ('requestIdleCallback' in window) {
    requestIdleCallback(_loadGA);
  } else {
    window.addEventListener('load', _loadGA);
  }

  // Track outbound links and CTAs (available after GA loads)
  function trackEvent(category, action, label, source) {
    if (window.gtag) {
      window.gtag('event', action, {
        'event_category': category,
        'event_label': label,
        'source': source
      });
    }
  }
</script>
{{ end }}
