[{"sentence":"Welcome back to another episode of Nerding out with Victor.","startTime":"00:03","endTime":"00:06","speaker_name":"Viktor Petersson","speaker_id":0},{"sentence":"Today we're going to go deep into the world of ZFS and FreeBSD with Alan Jude.","startTime":"00:06","endTime":"00:11","speaker_name":"Viktor Petersson","speaker_id":0},{"sentence":"Welcome to the show, Alan.","startTime":"00:11","endTime":"00:12","speaker_name":"Viktor Petersson","speaker_id":0},{"sentence":"Hello.","startTime":"00:12","endTime":"00:13","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"Thank you.","startTime":"00:13","endTime":"00:14","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"So you've been around the FreeBSD world for a long time, and I feel like I mentioned before you hit the record button, FreeBSD is not really getting enough attention for their deserves, really.","startTime":"00:14","endTime":"00:29","speaker_name":"Viktor Petersson","speaker_id":0},{"sentence":"So I guess for the people in the audience who are not Even familiar with FreeBSD and the BSD family, maybe can you do a quick intro to, like, why it sets it apart and just some big backstory?","startTime":"00:29","endTime":"00:41","speaker_name":"Viktor Petersson","speaker_id":0},{"sentence":"Yeah, I guess we can start with the initial part of the backstory.","startTime":"00:41","endTime":"00:44","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"So UNIX was originally developed at Bell Labs, which was the research arm of AT&T, the phone company, the only phone company in the US Back then.","startTime":"00:44","endTime":"00:54","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"And so they developed this operating system basically to be able to build things and also to convince management to buy them a big enough computer, also to make printed manuals and so on to do actual work for the phone company.","startTime":"00:55","endTime":"01:12","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"But that really was just a side effect of getting a computer they could use to actually write computer programs, a more comfortable environment.","startTime":"01:12","endTime":"01:20","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"And so they built this, and as it started going out, they found that they wanted people to know how to use it and to find new things to do with it.","startTime":"01:21","endTime":"01:32","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"So they licensed copies to a bunch of universities.","startTime":"01:32","endTime":"01:35","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"And back then, computer programs weren't really the same, and there was no standard architecture.","startTime":"01:36","endTime":"01:43","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"Right.","startTime":"01:43","endTime":"01:44","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"Every computer was a completely different computer that basically spoke a different language.","startTime":"01:44","endTime":"01:49","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"And so you had to write the operating system and the programs in, like, the compiled to this assembly dialect of that machine, which is completely different from some other machine.","startTime":"01:49","endTime":"02:01","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"And that's how or what led to the invention of the C programming language, as we can write the code once and compile it for multiple different machines.","startTime":"02:01","endTime":"02:10","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"Anyway, one of the universities that got a copy of original research, Unix, as it was called, was the University of California at Berkeley.","startTime":"02:11","endTime":"02:20","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"And they started adding things to it and changing it to be useful for them.","startTime":"02:20","endTime":"02:25","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"And eventually what they did was they would send copies of it on a tape because floppy disk hadn't been invented yet.","startTime":"02:25","endTime":"02:35","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"So they'd mail this tape to other universities and other people who would take it and they would change it and they would send back some of their changes.","startTime":"02:35","endTime":"02:42","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"Of course, you know, we didn't have Git or tools for managing patches.","startTime":"02:43","endTime":"02:47","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"So it was a little crazy back then.","startTime":"02:47","endTime":"02:50","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"But eventually some of those changes made it back to Berkeley and they got incorporated and went out to other people on the next Tape.","startTime":"02:50","endTime":"02:55","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"And that was kind of the precursor to open source.","startTime":"02:55","endTime":"02:59","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"No one had thought up licensing or text to put on it yet.","startTime":"02:59","endTime":"03:03","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"It was just, you know, this is the program and you use it.","startTime":"03:03","endTime":"03:06","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"And of course every program comes with all the source code and you can do whatever you want with it.","startTime":"03:06","endTime":"03:11","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"But then it turns out, you know, AT&T had ideas about this.","startTime":"03:12","endTime":"03:17","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"But that went on for a while and really got interesting.","startTime":"03:19","endTime":"03:22","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"And eventually they added things to it, including the TCP IP stack, which was the invention of the Internet.","startTime":"03:22","endTime":"03:29","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"And there's some great stories about that.","startTime":"03:29","endTime":"03:32","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"Kirk McKusick, one of the people who wrote the file system for that original Unix or the original BSD Unix has a history series on DVD that talks about some of the really interesting things around the invention of TCP ip.","startTime":"03:32","endTime":"03:46","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"And there was like a proprietary version and then the BSD version.","startTime":"03:46","endTime":"03:50","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"And the BSD version was faster at some parts, but worse at other parts.","startTime":"03:50","endTime":"03:55","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"And the way the story went was the proprietary one was faster, but it would crash.","startTime":"03:56","endTime":"04:02","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"And in the time while it was rebooting, after it crashed, the BSD one would catch up.","startTime":"04:02","endTime":"04:06","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"So if you transferred a big enough file, you would still be faster on the BSD1 and things like that.","startTime":"04:06","endTime":"04:13","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"I didn't even know that.","startTime":"04:13","endTime":"04:14","speaker_name":"Viktor Petersson","speaker_id":0},{"sentence":"Okay, Yeah, I didn't know that.","startTime":"04:14","endTime":"04:15","speaker_name":"Viktor Petersson","speaker_id":0},{"sentence":"I didn't even know that backstory of the TPIP stacks actually.","startTime":"04:15","endTime":"04:18","speaker_name":"Viktor Petersson","speaker_id":0},{"sentence":"Yeah, that was, I think BBN it was called.","startTime":"04:18","endTime":"04:21","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"It was like way back at the very beginning, like when the Internet was only for the government.","startTime":"04:21","endTime":"04:25","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"It wasn't the open Internet yet.","startTime":"04:25","endTime":"04:27","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"Right, right.","startTime":"04:27","endTime":"04:28","speaker_name":"Viktor Petersson","speaker_id":0},{"sentence":"It's probably still the arpanet.","startTime":"04:28","endTime":"04:29","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"Yes, and things like that.","startTime":"04:29","endTime":"04:31","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"Anyway, that's a great lecture that Kirk gives that you can catch from other conferences or from history dvd.","startTime":"04:31","endTime":"04:38","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"But eventually they kind of finished up the last version of that and a company started called BSDI that was going to make a version of this and actually sell it.","startTime":"04:40","endTime":"04:52","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"And so they did the port to what was the 386 and made this BSDOS and they were going to sell it to people.","startTime":"04:53","endTime":"05:00","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"And it was, they were doing a pretty brisk business at the time because, you know, your only other option was Windows or probably wasn't even Windows yet.","startTime":"05:01","endTime":"05:11","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"Like, yeah, early versions of Windows or like sunos, which was expensive and came with special hardware, whereas the 386 was a cheap machine you could just buy.","startTime":"05:11","endTime":"05:20","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"Right.","startTime":"05:20","endTime":"05:21","speaker_name":"Viktor Petersson","speaker_id":0},{"sentence":"But they made the probably ill advised decision to have their phone number to order this software be 100 its Unix.","startTime":"05:23","endTime":"05:31","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"Whereas Unix was a trademark of AT&T.","startTime":"05:32","endTime":"05:35","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"And AT&T is like, yeah, no, Also, your code probably contains, you know, our code, which, you know, we charge $1,000 a license for at least, or if not, a lot more.","startTime":"05:36","endTime":"05:50","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"And you know, you're selling your software to other people for less than that, so you're not paying us.","startTime":"05:50","endTime":"05:55","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"How does that work?","startTime":"05:55","endTime":"05:56","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"And this led to the famous ATT USL lawsuit.","startTime":"05:56","endTime":"06:00","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"And it turned out there were maybe seven files that needed to be rewritten, but not really.","startTime":"06:02","endTime":"06:08","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"I don't think the final details ever really got fully disclosed.","startTime":"06:08","endTime":"06:12","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"Right.","startTime":"06:12","endTime":"06:13","speaker_name":"Viktor Petersson","speaker_id":0},{"sentence":"But it slowed BSD down, especially the adoption of it, at just the wrong time, as it turns out.","startTime":"06:13","endTime":"06:19","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"And so in Finland this student named Linus was like, you know, I want a Unix like operating system and oh, I can't use BSD because it's tied up in this lawsuit, so I'll have to build my own.","startTime":"06:21","endTime":"06:35","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"And that was the start of Linux.","startTime":"06:36","endTime":"06:37","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"And like you said, if it hadn't been for the AT and T lawsuit, I would have never bothered making Linux and we would just have BSD instead.","startTime":"06:37","endTime":"06:44","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"It's a crazy parallel universe, right?","startTime":"06:46","endTime":"06:49","speaker_name":"Viktor Petersson","speaker_id":0},{"sentence":"Yeah, yeah, that's a really interesting parallel universe.","startTime":"06:49","endTime":"06:53","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"Like how that would have affected the evolution of the UNIX wars and what would have happened where and how different life might be just because of the licensing.","startTime":"06:53","endTime":"07:04","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"So BSD and similar stuff like the MIT license, ISC license, basically the whole license is a couple of sentences that say, you can use this code for whatever you want, but don't take our name off of it and don't claim you were the one that wrote it.","startTime":"07:04","endTime":"07:20","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"And so the Sony PlayStation 4 and 5 are based on FreeBSD.","startTime":"07:20","endTime":"07:26","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"And so at the back of the manual there's a bunch of pages of copyright notices that saying, this contains code from this person and this person and so on.","startTime":"07:26","endTime":"07:36","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"And that's the extent of Sony's obligation, right?","startTime":"07:36","endTime":"07:40","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"Well, many of the companies that use this BSD software do give back because there's an advantage to doing so.","startTime":"07:41","endTime":"07:46","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"You know, if you're taking FreeBSD and building something on top of it, you're making some changes.","startTime":"07:47","endTime":"07:52","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"If some of those changes will be your intellectual property or is it the unique selling feature of your product and you want to keep those secret, but there are other parts and smaller features and so on that aren't secret but will be work for you.","startTime":"07:52","endTime":"08:06","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"Every time you upgrade to a newer version, you will have to reintegrate those, and that's a lot of work.","startTime":"08:06","endTime":"08:11","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"If you can contribute those back, they become part of the main line and everybody collectively maintains them, then it's that much easier for you to update in the future.","startTime":"08:11","endTime":"08:20","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"And really I think the thing that sells it for me the most is the thought of if I buy a washing machine that has the ability to send a push notification to my cell phone when the laundry is done, I don't want it to be using some proprietary or hand built network stack because the people who wrote the software on it didn't want to give back to the gpl which has this viral clause that means any code that touches this has to become open.","startTime":"08:21","endTime":"08:51","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"So if they're going to use some closed source thing that they bought or write their own thing to avoid that's probably going to lead to a bad time.","startTime":"08:52","endTime":"09:01","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"Whereas if they can have this standard reference implementation that is under a liberal license, then we're probably all in better shape.","startTime":"09:01","endTime":"09:09","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"Yeah.","startTime":"09:10","endTime":"09:11","speaker_name":"Viktor Petersson","speaker_id":0},{"sentence":"So that takes us to the modern BSD landscape, I guess, where you have, well, three, well, I guess three major flavors of bsd Open, Free, nat.","startTime":"09:11","endTime":"09:21","speaker_name":"Viktor Petersson","speaker_id":0},{"sentence":"I guess they're all.","startTime":"09:22","endTime":"09:23","speaker_name":"Viktor Petersson","speaker_id":0},{"sentence":"They are the main ones.","startTime":"09:23","endTime":"09:24","speaker_name":"Viktor Petersson","speaker_id":0},{"sentence":"There is.","startTime":"09:24","endTime":"09:24","speaker_name":"Viktor Petersson","speaker_id":0},{"sentence":"There are some derivatives of those I think as well.","startTime":"09:24","endTime":"09:27","speaker_name":"Viktor Petersson","speaker_id":0},{"sentence":"But those are the main ones today.","startTime":"09:27","endTime":"09:28","speaker_name":"Viktor Petersson","speaker_id":0},{"sentence":"Right.","startTime":"09:28","endTime":"09:28","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"Can you speak a bit?","startTime":"09:30","endTime":"09:31","speaker_name":"Viktor Petersson","speaker_id":0},{"sentence":"Just compare and contrast like real quickly, like for those who.","startTime":"09:31","endTime":"09:34","speaker_name":"Viktor Petersson","speaker_id":0},{"sentence":"Not those who are new to BSD and just understand what their strengths are between the three of them.","startTime":"09:34","endTime":"09:40","speaker_name":"Viktor Petersson","speaker_id":0},{"sentence":"Yeah.","startTime":"09:40","endTime":"09:41","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"So back in the early 90s when, after the BSD USL lawsuit was settled and it became possible, these different versions of BSD came out and the first two were NetBSD and FreeBSD.","startTime":"09:41","endTime":"09:56","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"And NetBSD wanted to focus on portability running on all those different types of computer.","startTime":"09:56","endTime":"10:02","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"Especially at the time there were, you know, in the early 90s there were still a lot of these older big iron machines around and companies maybe weren't still producing new software for them.","startTime":"10:03","endTime":"10:15","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"And there were these ideas of other CPU architectures other than the X86.","startTime":"10:15","endTime":"10:20","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"And NetBSD really wanted to focus on, you know, when a new thing comes out, we can port to it and be running on it really quickly because they saw that as being the future of computers, not this 386, 486 type thing.","startTime":"10:21","endTime":"10:34","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"So their focus is always on this portability and being able to run on all the different types of CPUs at the same time.","startTime":"10:35","endTime":"10:43","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"With FreeBSD the focus was we have this one main architecture, the 386 and eventually the x86.","startTime":"10:43","endTime":"10:51","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"And we really want to be able to use that as a desktop and a serp.","startTime":"10:51","endTime":"10:55","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"And so that was their book.","startTime":"10:56","endTime":"10:57","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"After a couple of years, One of the NetBSD developers had a falling out with the other developers and wanted to do something quite a bit different.","startTime":"10:58","endTime":"11:07","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"And so they forked off from NetBSD and created OpenBSD.","startTime":"11:07","endTime":"11:10","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"The main goals there was that the repository, not just the source code, but the repository and the history, would be open to the public and then have a really big focus on security.","startTime":"11:11","endTime":"11:23","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"And it's come to the point where OpenBSD is mostly kind of like the original Unix, an environment for the developers to do things, whether that's their everyday things or building and kind of this incubator for all these ideas of different ways to do security.","startTime":"11:23","endTime":"11:40","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"So on top of their other enhancements, they've done the idea of privilege separation.","startTime":"11:41","endTime":"11:47","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"So one of the things that's kind of maintained inside the OpenBSD project is OpenSSH, the SSH server that's used in every operating system.","startTime":"11:47","endTime":"11:56","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"And originally that had this one bigger binary that ran as root and then could spawn, you know, every time you logged in.","startTime":"11:56","endTime":"12:04","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"But that's now been split up into separate tools so that if one gets compromised, it's running without the same level of privileges that, you know, any risky processing is done as like a less important user that can only communicate over interprocess communication with the main process that has all the privileges, so that less chances of it being exploited.","startTime":"12:04","endTime":"12:27","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"Right.","startTime":"12:28","endTime":"12:29","speaker_name":"Viktor Petersson","speaker_id":0},{"sentence":"And then they've taken that idea further and further as they've gone.","startTime":"12:29","endTime":"12:32","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"But one of the other really interesting ones they do is they actually relink.","startTime":"12:33","endTime":"12:38","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"So not compiling, but assembling the bits together, the kernel every time it reboots.","startTime":"12:38","endTime":"12:44","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"So as it's booting up, it makes a new kernel for next time, basically.","startTime":"12:45","endTime":"12:49","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"And it puts all the pieces together in a random order so that no machine will be exactly the same for an exploit to be able to know where it's going to find like the.","startTime":"12:49","endTime":"13:00","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"Certain functions for memory injections or for memory attacks, essentially.","startTime":"13:00","endTime":"13:04","speaker_name":"Viktor Petersson","speaker_id":0},{"sentence":"Yeah.","startTime":"13:04","endTime":"13:04","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"For basically any kind of memory attack.","startTime":"13:04","endTime":"13:06","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"Where you're going to try to find these gadgets to string together, do an exploit.","startTime":"13:06","endTime":"13:09","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"Every time this machine reboots, it'll be different.","startTime":"13:10","endTime":"13:12","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"And that means every machine will be different and you won't be able to have the same kind of.","startTime":"13:12","endTime":"13:16","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"It'll make the attacker's life that much harder.","startTime":"13:16","endTime":"13:19","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"Right.","startTime":"13:19","endTime":"13:20","speaker_name":"Viktor Petersson","speaker_id":0},{"sentence":"And they do a lot of interesting work like that.","startTime":"13:20","endTime":"13:22","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"Yeah.","startTime":"13:22","endTime":"13:23","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"I love the slogan for OpenBSD was no default vulnerabilities for like 10 years or whatever it was, or 15 years, whatever the number is today.","startTime":"13:23","endTime":"13:31","speaker_name":"Viktor Petersson","speaker_id":0},{"sentence":"Right.","startTime":"13:31","endTime":"13:31","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"And then it became kind of a heck of a long time when there was one.","startTime":"13:31","endTime":"13:34","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"The one time.","startTime":"13:34","endTime":"13:35","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"And.","startTime":"13:35","endTime":"13:35","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"Right.","startTime":"13:36","endTime":"13:36","speaker_name":"Viktor Petersson","speaker_id":0},{"sentence":"They've Had a really good track record on.","startTime":"13:37","endTime":"13:39","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"Yeah, it's pretty cool in terms of just to compare and contrast, do they share kernels or they completely.","startTime":"13:39","endTime":"13:46","speaker_name":"Viktor Petersson","speaker_id":0},{"sentence":"They just.","startTime":"13:46","endTime":"13:47","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"Toolkit.","startTime":"13:47","endTime":"13:48","speaker_name":"Viktor Petersson","speaker_id":0},{"sentence":"Yeah, so the kernels, I suppose technically were close to the same in the very early 90s, but they are very diverged.","startTime":"13:48","endTime":"13:57","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"Now one of the things that sets each of the three BSDs apart from something like a Linux is that each one is a complete operating system.","startTime":"13:57","endTime":"14:07","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"In that, you know, in one repository you have the kernel, the basic utilities, like ls, cat, grep, et cetera, and a bunch of the other pieces.","startTime":"14:07","endTime":"14:19","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"And all the drivers all live in one source code repository and can be built and run with just that.","startTime":"14:19","endTime":"14:27","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"And in fact, I pretty sure in all three of them that a bunch of the stuff comes with the operating system and then the packages are off to the side and by default there won't be any packages installed.","startTime":"14:27","endTime":"14:41","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"And then you can maybe you install whatever additions you need on top of the operating system.","startTime":"14:41","endTime":"14:46","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"Whereas almost every Linux distribution is all right, we take the a version of the kernel, that who knows which one, and we combine it with this bunch of GNU Core utils and other things, and all of those are packages that get installed.","startTime":"14:46","endTime":"15:00","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"And so the concept of having an operating system with no packages in Linux doesn't really make any sense because all of the components of the operating system, including the kernel, are packages.","startTime":"15:00","endTime":"15:09","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"Whereas in the bsds you have the operating system and then separately you have all the third party package, right?","startTime":"15:10","endTime":"15:16","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"And the package managers are rather sophisticated, like the ports from bsd.","startTime":"15:16","endTime":"15:21","speaker_name":"Viktor Petersson","speaker_id":0},{"sentence":"I know that was overhauled a decade ago, right?","startTime":"15:21","endTime":"15:24","speaker_name":"Viktor Petersson","speaker_id":0},{"sentence":"It used to be just tarballs and now that, yeah, they redesigned that, I think, what, 10 years ago.","startTime":"15:24","endTime":"15:31","speaker_name":"Viktor Petersson","speaker_id":0},{"sentence":"I think.","startTime":"15:31","endTime":"15:32","speaker_name":"Viktor Petersson","speaker_id":0},{"sentence":"In the very beginning FreeBSD added this concept of ports, which is basically a separate repository with a directory structure sorted into categories and then each program has a directory and inside it there's a little make file, a little.","startTime":"15:34","endTime":"15:49","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"Oh, yes, sorry, yes, make.","startTime":"15:49","endTime":"15:51","speaker_name":"Viktor Petersson","speaker_id":0},{"sentence":"And in there when you run the right command, it knows, hey, I need to go to this website, download the source code, extract it, check the checksum to make sure nobody's feeding me the wrong source code, extract it, apply the set of patches, maybe run the configure script, compile it, install it, and so on, and make sure it gets installed to the right place and that you have all the information you need to be able to uninstall it and all that.","startTime":"15:51","endTime":"16:16","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"And so it did that for a long time and there were binary packages, but back in the early days, the way it worked Was all of those packages were built once at the day of the release and included on a second cd, but they were never updated.","startTime":"16:17","endTime":"16:36","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"So you had the version of the packages that shipped with the operating system when it came out and if it was six months later, sorry, all you have is this old packages and you'd have to build your own from the ports tree and that was it.","startTime":"16:36","endTime":"16:50","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"And it was not ideal.","startTime":"16:50","endTime":"16:53","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"So yeah, I think around FreeBSD8 for reference, we're on version 14 right now.","startTime":"16:53","endTime":"16:58","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"With FreeBSD8 we released a new package manager that meant somebody would a tool called Poodra would take that ports tree and recompile it every three or four days because it takes that long to do the build and post it.","startTime":"16:59","endTime":"17:13","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"And so you could just do package upgrade and it would download stuff kind of the same as an APT or a Yum or whatever.","startTime":"17:13","endTime":"17:19","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"Yeah, because I remember the big difference is that gets rebuilt every three or four days.","startTime":"17:19","endTime":"17:23","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"So it's very fresh.","startTime":"17:23","endTime":"17:25","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"Yeah, because I remember one of the issues.","startTime":"17:26","endTime":"17:27","speaker_name":"Viktor Petersson","speaker_id":0},{"sentence":"I used to run BSD, FreeBSD specifically many years ago and we ran it at somewhat small scale but like I think, I don't know, 50 servers maybe so smallish scale but I remember do those installations across a fleet of servers where you have to compile everything on every single server and then you have to.","startTime":"17:29","endTime":"17:47","speaker_name":"Viktor Petersson","speaker_id":0},{"sentence":"There were some mechanisms for distributing packages but it's very different from the Linux world, which is apt get installed and voila, that's all you have to care about.","startTime":"17:47","endTime":"17:55","speaker_name":"Viktor Petersson","speaker_id":0},{"sentence":"Yeah.","startTime":"17:56","endTime":"17:57","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"And so eventually we added the concept of a quarterly branch.","startTime":"17:57","endTime":"18:00","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"So on top of those packages built every three or four days, there's a second repo also built every three or four days.","startTime":"18:01","endTime":"18:07","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"But is the major versions of those packages only change once every three months.","startTime":"18:07","endTime":"18:12","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"So that you have the choice of basically a rolling release or a quarterly release that's just security fixes every day, but doesn't randomly change from version three to version four of a program in the middle of your cycle so that you can safely just run automated packages.","startTime":"18:13","endTime":"18:32","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"And the big thing is with that system there's also the available the program called pudrare which allows you to compile those packages yourself.","startTime":"18:33","endTime":"18:43","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"So if you have that fleet of 50 servers, the big thing that the ports tree let you do is there are configuration options for all these programs.","startTime":"18:43","endTime":"18:52","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"So you know, you can decide whether you want this program.","startTime":"18:52","endTime":"18:56","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"Like if you're installing WordPress, do you want it to use MySQL or Postgres as the database or something like that.","startTime":"18:56","endTime":"19:02","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"And there's all These knobs you can tweak, but the packages that come from upstream only have the defaults.","startTime":"19:03","endTime":"19:08","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"So if you want different options, then you can use podrare and build your own package repository that's going to have those options and be able to use it for all 50 of your servers.","startTime":"19:09","endTime":"19:19","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"Right.","startTime":"19:19","endTime":"19:20","speaker_name":"Viktor Petersson","speaker_id":0},{"sentence":"Are those reproducible builds now?","startTime":"19:20","endTime":"19:23","speaker_name":"Viktor Petersson","speaker_id":0},{"sentence":"Pretty close to it.","startTime":"19:24","endTime":"19:25","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"The operating system is fully reproducible and I think the packages are reproducible as well.","startTime":"19:25","endTime":"19:31","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"You have to, not necessarily by default.","startTime":"19:31","endTime":"19:33","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"You have to set a couple of options to enable it because there's some downsides to faking the date you set for everything.","startTime":"19:33","endTime":"19:40","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"But yeah, there's a lot of work that's gone into making that more reproducible so that you can take the same source code and the same tool set and build the identical CD for FreeBSD 13.3 to prove that what the FreeBSD release engineering team gave you came from this exact source code.","startTime":"19:40","endTime":"20:02","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"Yeah, I mean that's super important.","startTime":"20:02","endTime":"20:04","speaker_name":"Viktor Petersson","speaker_id":0},{"sentence":"So let's talk a bit about what actually BSD has been used for FreeBSD in particular, Netflix massive FreeBSD shop, at least was.","startTime":"20:04","endTime":"20:12","speaker_name":"Viktor Petersson","speaker_id":0},{"sentence":"I'm not sure they still are.","startTime":"20:12","endTime":"20:13","speaker_name":"Viktor Petersson","speaker_id":0},{"sentence":"I think they are still using the cdn.","startTime":"20:13","endTime":"20:14","speaker_name":"Viktor Petersson","speaker_id":0},{"sentence":"Are they?","startTime":"20:14","endTime":"20:15","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"Are, are they still running their entire CDN on Netflix?","startTime":"20:15","endTime":"20:18","speaker_name":"Viktor Petersson","speaker_id":0},{"sentence":"On FreeBSD when you are browsing Netflix and picking a video that all runs in Amazon on Linux, but as soon as the video starts playing, that's all coming from FreeBSD.","startTime":"20:18","endTime":"20:29","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"And so yeah, they built this thing called the Open Connect appliance, which was customized server that they could send to Internet exchanges, but specifically to your ISP.","startTime":"20:30","endTime":"20:41","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"So when they first started they were using commercial CDNs, but that got too expensive and it got to be that Netflix individually was such a high percentage of the Internet traffic that there weren't any more bandwidth providers available that they weren't already busy with Netflix traffic.","startTime":"20:42","endTime":"21:01","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"And so to help ameliorate that, they came up with this concept of the Open Connect appliance, which they would basically send to your ISP and your ISP would install in their data center, so that the most popular videos and TV shows that you're watching would be coming from the box inside their network and wouldn't use any of your ISP's Internet traffic, saving your ISP a bunch of money and saving Netflix a bunch of money.","startTime":"21:01","endTime":"21:23","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"So it worked out pretty well, and Netflix didn't really invent that concept.","startTime":"21:23","endTime":"21:27","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"Akamai, one of the bigger CDNs had come up with that before, but not to the same degree that what Netflix did.","startTime":"21:27","endTime":"21:34","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"And so Netflix chose to use FreeBSD for that because of a couple of reasons.","startTime":"21:34","endTime":"21:39","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"A the license, although it turns out they don't have any proprietary code that's actually in the operating system, so that doesn't matter so much for them.","startTime":"21:39","endTime":"21:46","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"But the big thing for them was the speed with which they could upstream stuff.","startTime":"21:46","endTime":"21:51","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"So when they made a change, they were able to contribute it back to FreeBSD and then have it included in the mainline within a couple of weeks.","startTime":"21:51","endTime":"21:59","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"And so they run the development version of FreeBSD, so not the releases, but actually the development version some number of weeks behind live.","startTime":"22:00","endTime":"22:08","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"I think it's like six weeks or something.","startTime":"22:08","endTime":"22:09","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"And so with that they're able to find problems, engineer a solution and get it upstream and then have it ship.","startTime":"22:12","endTime":"22:19","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"Whereas if they worked with Linux, it would be a lot harder to get a change into the kernel in general.","startTime":"22:19","endTime":"22:26","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"And if they did, by time a distribution shipped it could be like three years.","startTime":"22:26","endTime":"22:33","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"They could do their own thing, but that'd be a lot more work.","startTime":"22:34","endTime":"22:37","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"And just the fact that FreeBSD has all the infrastructure to basically make your own distribution kind of included made it really easy for them, especially because they ended up making quite a few changes.","startTime":"22:37","endTime":"22:48","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"They worked with NIC vendors including Mellanox, which is now Nvidia and Chelsea to design this concept of encryption offload.","startTime":"22:49","endTime":"22:59","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"So one thing that set BSD apart back in the early days of like FreeBSD4 and like the early Internet, like very early 2000s or in late 90s, was it was really good at being an FTP server and a web server.","startTime":"23:00","endTime":"23:15","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"Part of that was this system special system call it had called Send File.","startTime":"23:16","endTime":"23:20","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"So normally, you know, we have a web server, back then it was mostly Apache running in user space and you know, a request comes in over the network and then we have to wake up the web server and say, hey, there's a new request, do you want to accept it?","startTime":"23:21","endTime":"23:33","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"Web server says, I'm not too busy, I'll accept it.","startTime":"23:34","endTime":"23:36","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"And it would go back to the kernel and then eventually a request comes in and it processes it and okay, I need to open this file.","startTime":"23:36","endTime":"23:42","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"And now I want to read some data from this file.","startTime":"23:42","endTime":"23:44","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"And now I'm going to ask the kernel, hey, could you send this to the user?","startTime":"23:44","endTime":"23:47","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"And then when that's done, tell me and I'll read another chunk of the file and then I'll send it to the kernel.","startTime":"23:48","endTime":"23:53","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"And it involves a lot of copying back and forth because you know, when the web server asks to read a file, it goes to the kernel, hey, could you read this file?","startTime":"23:53","endTime":"24:01","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"So the kernel reads it up and then has to copy it from the kernel to Apache.","startTime":"24:02","endTime":"24:06","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"And Apache doesn't look at it just immediately says, hey, kernel, this buffer you just gave me, could you write it back to this socket instead?","startTime":"24:06","endTime":"24:15","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"And it was all this back and forth.","startTime":"24:15","endTime":"24:17","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"So with send file, the web server or the FTP server can just say, hey, I have this socket and this file descriptor of a file I've opened.","startTime":"24:17","endTime":"24:24","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"Can you send this range of bytes in it to the socket for me and just tell me when you're done?","startTime":"24:24","endTime":"24:29","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"And so now, instead of having to cross that boundary back and forth all the time, you can just say, hey, kernel, just read from this file and write to the socket and do it until either there's an error or you finished the amount I asked you to do.","startTime":"24:30","endTime":"24:42","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"And that sped things up greatly.","startTime":"24:43","endTime":"24:45","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"But then HTTPs took off and now we need to encrypt all of that.","startTime":"24:47","endTime":"24:53","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"And so that meant we couldn't just have the kernel do it.","startTime":"24:53","endTime":"24:55","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"You had to still copy it out of the kernel to user space, then feed it through OpenSSL to encrypt it and then send it to the user, which involves copying it back into the kernel.","startTime":"24:55","endTime":"25:05","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"And this took away a lot of the performance that was available.","startTime":"25:06","endTime":"25:08","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"So they invented this concept of kernel tls, where basically your web server, now, modern days, usually nginx, will accept that connection, negotiate the encryption with the user, and then once it's done the public key part, right, and proven the SSL certificate and all that, it will have a symmetric key, basically a bulk encryption key.","startTime":"25:09","endTime":"25:30","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"And it can now set that as a socket option on the socket and then do the send file system call.","startTime":"25:30","endTime":"25:37","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"And now the kernel has the key it needs to encrypt the data, and it will actually, through a kernel module of OpenSSL, encrypt the data and send it whenever you write it to the socket.","startTime":"25:38","endTime":"25:48","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"So then the send file system call works again and it allows all this offload so you don't have to copy back and forth.","startTime":"25:48","endTime":"25:54","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"Which became especially a big deal after Spectre and Meltdown, where crossing that kernel user space boundary required a bunch of extra steps and slowed down a bit.","startTime":"25:54","endTime":"26:04","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"And so that made a big difference there.","startTime":"26:06","endTime":"26:07","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"But you're still doing the encryption on the cpu, which is fast, but not as fast as it could be.","startTime":"26:08","endTime":"26:14","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"So Netflix took it one step further after that when they wanted even more performance out of each server where there are dedicated chips on the NICs that can do the encryption.","startTime":"26:14","endTime":"26:23","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"So instead of sending that bulk encryption key to the kernel, you send it to the kernel, but the kernel sends it to the network card driver, and then it writes the data to the network card driver unencrypted.","startTime":"26:24","endTime":"26:35","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"And the NIC itself, in its own special CPU, will do the encryption and then send the packet on the network.","startTime":"26:35","endTime":"26:43","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"And so this allows you to offload all that CPU usage to a dedicated encryption chip on the nic.","startTime":"26:44","endTime":"26:49","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"And this allowed Netflix to originally go from, you know, maybe they could keep 100 gigabit server busy by sending all this traffic.","startTime":"26:50","endTime":"27:00","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"Now they're up to doing 800 gigabits per second from a single CPU server.","startTime":"27:00","endTime":"27:06","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"Wow, that's impressive.","startTime":"27:07","endTime":"27:09","speaker_name":"Viktor Petersson","speaker_id":0},{"sentence":"Yeah.","startTime":"27:09","endTime":"27:09","speaker_name":"Viktor Petersson","speaker_id":0},{"sentence":"I remember seeing a talk, I think it was EuroBSDcon I went to many years ago.","startTime":"27:09","endTime":"27:14","speaker_name":"Viktor Petersson","speaker_id":0},{"sentence":"Netflix did.","startTime":"27:14","endTime":"27:14","speaker_name":"Viktor Petersson","speaker_id":0},{"sentence":"I think it was.","startTime":"27:15","endTime":"27:15","speaker_name":"Viktor Petersson","speaker_id":0},{"sentence":"Maybe it was around the time they announced these OpenConnect boxes.","startTime":"27:15","endTime":"27:18","speaker_name":"Viktor Petersson","speaker_id":0},{"sentence":"And I remember them mentioning, because of the volume of traffic they're running through these boxes, the bugs that they discover are things that nobody else basically would have discovered in 10 years because of the sheer volume.","startTime":"27:18","endTime":"27:31","speaker_name":"Viktor Petersson","speaker_id":0},{"sentence":"Yeah, I remember there was one early on in the IPv6 stack, which was basically an overflow.","startTime":"27:31","endTime":"27:37","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"When you crossed 4 billion of something, it would go back to zero and it caused a problem.","startTime":"27:37","endTime":"27:42","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"And in general, so they would crash the kernel, but in general, nobody was sending so much traffic that they would do that in less than a month or two, even on a busy host, and probably even longer on another host.","startTime":"27:43","endTime":"27:54","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"And so it would happen infrequently enough that nobody really got overly bothered by it.","startTime":"27:54","endTime":"27:59","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"But when Comcast first switched to having IPv6 for all their customers, and so all those people suddenly switched from V4 to V6, going through Netflix, it would take out a Netflix box every couple of hours.","startTime":"27:59","endTime":"28:11","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"And so they quickly saw the pattern and were able to find the problem and fix it easily and upstream that into FreeBSD and have an errata node so that everybody got the fix.","startTime":"28:13","endTime":"28:22","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"And it was really interesting just to see that kind of interesting scaling issues.","startTime":"28:22","endTime":"28:27","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"Right, right.","startTime":"28:27","endTime":"28:28","speaker_name":"Viktor Petersson","speaker_id":0},{"sentence":"All right.","startTime":"28:28","endTime":"28:29","speaker_name":"Viktor Petersson","speaker_id":0},{"sentence":"And also there was a new announcement.","startTime":"28:29","endTime":"28:31","speaker_name":"Viktor Petersson","speaker_id":0},{"sentence":"The German Savant Fund decided to invest some pretty good chunk of change into the Freebies foundation, which I'm sure was very welcome to modernize some infrastructure.","startTime":"28:32","endTime":"28:41","speaker_name":"Viktor Petersson","speaker_id":0},{"sentence":"Because how big is the team, like the bsd, the active maintainers?","startTime":"28:41","endTime":"28:45","speaker_name":"Viktor Petersson","speaker_id":0},{"sentence":"How ballpark.","startTime":"28:45","endTime":"28:47","speaker_name":"Viktor Petersson","speaker_id":0},{"sentence":"One of the other big differences with FreeBSD is rather than on Linux, where there's Linus as the benevolent dictator for life, FreeBSD has a core team of nine people that's elected every two years by the developer base, and that entire developer base has write access to the repository, whereas in Linux it's Linus and a dozen lieutenants or so that actually have the ability to merge stuff and you just send them requests.","startTime":"28:47","endTime":"29:18","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"With FreeBSD there are 250ish people that can just directly commit stuff into the repositories.","startTime":"29:19","endTime":"29:28","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"And so anybody who's committed things in the last 365 days at the day of the election is allowed to vote.","startTime":"29:29","endTime":"29:37","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"And that decides the nine people that will kind of be in charge of a project for the next two years.","startTime":"29:37","endTime":"29:43","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"Interesting.","startTime":"29:43","endTime":"29:44","speaker_name":"Viktor Petersson","speaker_id":0},{"sentence":"Okay, yeah.","startTime":"29:44","endTime":"29:44","speaker_name":"Viktor Petersson","speaker_id":0},{"sentence":"Different Covenant model entirely then.","startTime":"29:44","endTime":"29:46","speaker_name":"Viktor Petersson","speaker_id":0},{"sentence":"Yeah.","startTime":"29:46","endTime":"29:47","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"And so the Sovereign Tech Agency's Sovereign Tech Fund is invested money in FreeBSD to improve some of the infrastructure and try to burn down the BugPal and get things in a more sustainable setup.","startTime":"29:47","endTime":"30:00","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"And then there's also funding coming from the Alpha Omega project to implement additional two FA and a bunch of other security stuff, including an audit of FreeBSD's native hypervisor.","startTime":"30:00","endTime":"30:15","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"So rather than KVM that they have on Linux, FreeBSD has something called Beehive, which was originally developed at a vendor, and when they decided they weren't going to use it, they upstreamed it and it became part of FreeBSD.","startTime":"30:15","endTime":"30:27","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"Right, okay, very interesting.","startTime":"30:27","endTime":"30:31","speaker_name":"Viktor Petersson","speaker_id":0},{"sentence":"All right, let's switch gear to the primary topic for this conversation, which is run zfs.","startTime":"30:31","endTime":"30:37","speaker_name":"Viktor Petersson","speaker_id":0},{"sentence":"Obviously it's really important to give the backstory of FreeBSD, because that's very tightly coupled with zfs, or at least in the history of it.","startTime":"30:37","endTime":"30:47","speaker_name":"Viktor Petersson","speaker_id":0},{"sentence":"So you can run bsd.","startTime":"30:48","endTime":"30:51","speaker_name":"Viktor Petersson","speaker_id":0},{"sentence":"Sorry, you can run ZFS on Linux these days as well.","startTime":"30:51","endTime":"30:55","speaker_name":"Viktor Petersson","speaker_id":0},{"sentence":"And maybe we can start there.","startTime":"30:55","endTime":"30:57","speaker_name":"Viktor Petersson","speaker_id":0},{"sentence":"ZFS on Linux and ZFS on bsd.","startTime":"30:58","endTime":"31:01","speaker_name":"Viktor Petersson","speaker_id":0},{"sentence":"And BSD is slightly different.","startTime":"31:01","endTime":"31:04","speaker_name":"Viktor Petersson","speaker_id":0},{"sentence":"Maybe talk a moment about that.","startTime":"31:05","endTime":"31:06","speaker_name":"Viktor Petersson","speaker_id":0},{"sentence":"How they differ and why they differ.","startTime":"31:06","endTime":"31:08","speaker_name":"Viktor Petersson","speaker_id":0},{"sentence":"Well, we can start back at the very quick intro in the beginning.","startTime":"31:09","endTime":"31:13","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"So Sun Microsystems started developing ZFS because they needed a new file system.","startTime":"31:14","endTime":"31:19","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"They had tried a couple of times to write new file systems, but they got the teams kind of too big, too quickly, and it got complicated and they ended up never finishing any of them.","startTime":"31:19","endTime":"31:28","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"So Jeff Bonwick handpicked a fresh graduate coming out of Brown University, and basically the two of them got locked in a room for a while with a whiteboard and came up with a whole new file system from scratch.","startTime":"31:29","endTime":"31:43","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"And especially trying to solve a lot of the problems that file systems had at the time.","startTime":"31:44","endTime":"31:49","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"Because if you think back to the early 2000s, most file systems had a limit on the biggest file you could have.","startTime":"31:49","endTime":"31:55","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"So depending if you're on Windows, it was like 2 gigabytes was the biggest file you could have.","startTime":"31:56","endTime":"32:00","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"And some of them you couldn't have a partition bigger than 4 gigabytes.","startTime":"32:00","endTime":"32:05","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"And weird things like this.","startTime":"32:05","endTime":"32:06","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"Even on Linux, most of the file systems there was a limit to how big the biggest file you could have is how many files you could have, how big the volume could be.","startTime":"32:07","endTime":"32:16","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"All these things were relatively tight limits were actually running into.","startTime":"32:16","endTime":"32:20","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"Most of them are now big enough that they're harder to run into.","startTime":"32:21","endTime":"32:23","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"But ZFS was designed with the idea that everything was dynamically allocated so you can't run out of inodes.","startTime":"32:24","endTime":"32:31","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"If you throw a billion files at it, you're not ever going to get an error.","startTime":"32:31","endTime":"32:34","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"Most file systems now still have a limit to the number of inodes.","startTime":"32:35","endTime":"32:39","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"Some of them can dynamically add more after, like you can run a command to adjust the limit and add more.","startTime":"32:39","endTime":"32:45","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"But they all do still have a limit, whereas ZFS just doesn't because it allocates them dynamically.","startTime":"32:46","endTime":"32:51","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"It's like you can have as many as you need until you run out of space, right?","startTime":"32:51","endTime":"32:55","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"But the other big thing was every other file system that exists right now.","startTime":"32:55","endTime":"33:00","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"Traditional file system assumes you have one disk and it only uses that one disk.","startTime":"33:00","endTime":"33:06","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"If you have multiple disks, you have to use a volume manager like MD RAID on Linux, or a hardware RAID controller or something to turn that multiple disks into one fake disk that you can then feed to the file system.","startTime":"33:06","endTime":"33:17","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"ZFS has that functionality built in so you can give it all your disks and it actually knows that they are individual disks and can do things with them.","startTime":"33:18","endTime":"33:25","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"Anyway, after a couple of years, sun decided to open source that, because everything at sun was open source, because they found that model was better and it was their competitive advantage over something like Windows.","startTime":"33:27","endTime":"33:37","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"And So when some FreeBSD developers saw that, they're like, well, you know, Solaris originally spawned out of bsd, yeah, many of the concepts are not that different.","startTime":"33:39","endTime":"33:49","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"We'd be able to port this.","startTime":"33:49","endTime":"33:50","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"And so one developer in particular, Pavel Doadek, ported ZFS to FreeBSD.","startTime":"33:51","endTime":"33:57","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"You know, he did most of the initial work in a kind of mad sprint over just less than a month of getting it from it's not in FreeBSD to.","startTime":"33:57","endTime":"34:07","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"You can actually mount and read write files in a ridiculously short amount of time.","startTime":"34:07","endTime":"34:13","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"So you did that.","startTime":"34:15","endTime":"34:16","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"And ZedFS started coming into FreeBSD and getting a lot of attention from that.","startTime":"34:16","endTime":"34:21","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"And that continued for a long Time when Oracle bought sun, they closed off the source code.","startTime":"34:21","endTime":"34:28","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"So a project called the lumos, which is a fork of the last open source version of Solaris, started and previously switched to using that as where it would get newer ZFS features from and where it would contribute its changes back to.","startTime":"34:28","endTime":"34:40","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"But at that time, each version of ZFS was kind of unique to that operating system.","startTime":"34:41","endTime":"34:45","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"It was up to each operating system to kind of maintain their version and try to keep them in sync.","startTime":"34:46","endTime":"34:50","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"And then the ZFS on Linux project started around that time as well, having their first release a while after FreeBSD, but they've been working on it around the same time that FreeBSD started, and eventually that became the ZFS on Linux project and was also there on GitHub.","startTime":"34:51","endTime":"35:08","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"And as things changed and some of the companies that were using Solaris and Lumos switched to using other things or just, you know, their time came to an end, less and less new features were being added in the LUMOS repo, and more of them were appearing in FreeBSD and Linux.","startTime":"35:10","endTime":"35:27","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"And then getting them back into Illumos and then there and then waiting to be able to pull them back in was causing delays, but also just features were being added in different orders and it was getting kind of complicated.","startTime":"35:28","endTime":"35:38","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"So that student I mentioned who originally helped design ZFS has now been doing it for over 20 years and is the leader of the project.","startTime":"35:40","endTime":"35:50","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"He came up with this concept of open ZFS where we would have one repo that was just the agnostic code, just the core of ZFS and not the integration with each operating system.","startTime":"35:50","endTime":"36:02","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"Right, okay.","startTime":"36:02","endTime":"36:03","speaker_name":"Viktor Petersson","speaker_id":0},{"sentence":"And we could compile this in user space and run all the tests, and basically have a common code base that each operating system can pull from, add the glue for their operating system and go from there.","startTime":"36:03","endTime":"36:14","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"But that didn't really manage to go anywhere because that upstream repo by itself wasn't useful because it didn't have the integration for any operating system.","startTime":"36:15","endTime":"36:24","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"It was just the common code.","startTime":"36:24","endTime":"36:26","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"And so it meant somebody would have to do a lot of work to be able to actually get that running and build the infrastructure around it to test it, but to no direct value to them or anybody.","startTime":"36:27","endTime":"36:38","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"And so that concept was there and the REPO existed and we'd push and pull code from it, but it was not really working as intended.","startTime":"36:39","endTime":"36:49","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"So especially as more development started coming in on the Linux side and things were getting kind of done out of order a bit, and it was just getting complicated to, you know, eventually they had a bunch of features that FreeBSD didn't have.","startTime":"36:50","endTime":"37:05","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"But FreeBSD wanted to pull from Illumos, but Illumos didn't have those features yet.","startTime":"37:05","endTime":"37:09","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"It got complicated.","startTime":"37:09","endTime":"37:10","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"So we looked at the idea of having a real version of the OpenZFS repo, which would be one repository that includes the OS glue for all of the operating systems and means it would be one official upstream code repository that'd be the same on all the operating systems.","startTime":"37:10","endTime":"37:28","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"Right.","startTime":"37:28","endTime":"37:29","speaker_name":"Viktor Petersson","speaker_id":0},{"sentence":"And so in time for FreeBSD 13.0, that project happened.","startTime":"37:29","endTime":"37:34","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"And so the OpenZFS repo you see on GitHub now actually is Linux and FreeBSD's code mixed together basically under the modules subdirectory, there's an OS directory and there's one for Linux and one for FreeBSD, and all the common code lives in module ZFS.","startTime":"37:34","endTime":"37:50","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"And then the operating systems have their special bits in those other directories and it means the code is literally exactly the same.","startTime":"37:51","endTime":"37:58","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"On FreeBSD and Linux it all comes from exactly the same source code.","startTime":"37:58","endTime":"38:02","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"There are one set of files that are different based on which operating system you're running, mostly just to integrate with those kernels which are different and provide what we call the Solaris porting layer, which translates the common codes Solaris calls into Linux.","startTime":"38:02","endTime":"38:17","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"Or FreeBSD calls for things like allocating memory from the kernel, which is done differently.","startTime":"38:17","endTime":"38:21","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"Linux has the slab allocator and FreeBSD has the UMA, the Unified Memory architecture and so on.","startTime":"38:22","endTime":"38:29","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"Right, but it means that we have the same code and we added version numbers so you can actually see, you know, FreeBSD14 and Ubuntu 2404 have basically the same version of ZFS.","startTime":"38:29","endTime":"38:40","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"Right, but there if remind me, there was some issue that held back ZFS coming into mainline Linux for quite some time and it was a license related issue, if I'm mistaken.","startTime":"38:41","endTime":"38:51","speaker_name":"Viktor Petersson","speaker_id":0},{"sentence":"Right, and so technically that's still true.","startTime":"38:51","endTime":"38:54","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"Their ZFS is not included in mainline Linux.","startTime":"38:54","endTime":"38:57","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"So when sun released zfs, they did it under a license called the cddl, the Common Development License, which is basically identical to Mozilla's MPL that Firefox has released under.","startTime":"38:58","endTime":"39:11","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"So it says the source code is under this CDDL license, which is mostly liberal, it's not viral or anything like the gpl, but in particular Kadenta clause that when you compile a binary out of it, you can license that binary however you like.","startTime":"39:11","endTime":"39:27","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"So you can take ZFS and compile a kernel module and license that module as gpl.","startTime":"39:29","endTime":"39:35","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"The problem is actually an incompatibility with the GPL where if you make this GPL license ZFS module and link it into your kernel, the GPL license says that should make the source code for ZFS GPL licensed.","startTime":"39:37","endTime":"39:51","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"And the CDDale doesn't let you do that because that would not make any sense.","startTime":"39:52","endTime":"39:56","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"Right.","startTime":"39:57","endTime":"39:57","speaker_name":"Viktor Petersson","speaker_id":0},{"sentence":"And so that's where the issues come from.","startTime":"39:58","endTime":"40:02","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"And so it's not included in upstream.","startTime":"40:03","endTime":"40:06","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"Kind of like was it the bcachefs recently was getting added to Linux and it sounds like maybe it doesn't have a long life left after some arguments between the maintainers.","startTime":"40:07","endTime":"40:18","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"So ZFS is not included in mainline, but Ubuntu has started shipping it as part of their distro and it turns out nobody's suing them.","startTime":"40:19","endTime":"40:28","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"And so it has kind of become okay to basically for Ubuntu to compile it for you and you load it on your module, whereas, you know, it was always okay for you to compile it yourself and load it on whatever version of Linux you wanted.","startTime":"40:28","endTime":"40:43","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"But that was a bit of a pain with dkms is not really a pain anymore, but being able to start to get closer to the integration like you can see with FreeBSD, where our bootloader fully supports it and our installer knows all about it.","startTime":"40:43","endTime":"40:58","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"And we build features like boot environments on top of it, which is basically having multiple different root file systems, possibly based on snapshots of your root file system.","startTime":"40:59","endTime":"41:08","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"Meaning that if you install some new packages and it breaks something, you can just reboot and from your bootloader pick an older version of your root file system and be back to how your system was an hour ago and everything works again.","startTime":"41:08","endTime":"41:21","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"It's crazy.","startTime":"41:22","endTime":"41:23","speaker_name":"Viktor Petersson","speaker_id":0},{"sentence":"Like one of the things, like I've been using ZFS for well over a decade, I think by now, in one capacity or another.","startTime":"41:23","endTime":"41:29","speaker_name":"Viktor Petersson","speaker_id":0},{"sentence":"And the thing that always strikes me is this is the fastest, but it's very old.","startTime":"41:29","endTime":"41:34","speaker_name":"Viktor Petersson","speaker_id":0},{"sentence":"But it's still probably the most sophisticated file system out there in terms of feature sets.","startTime":"41:34","endTime":"41:39","speaker_name":"Viktor Petersson","speaker_id":0},{"sentence":"And it just keeps chugging along and it's just so reliable, have so many beautiful features that are not widely available across any other file system, really.","startTime":"41:39","endTime":"41:49","speaker_name":"Viktor Petersson","speaker_id":0},{"sentence":"Like particularly about snapshots and all these things.","startTime":"41:49","endTime":"41:52","speaker_name":"Viktor Petersson","speaker_id":0},{"sentence":"Right.","startTime":"41:52","endTime":"41:53","speaker_name":"Viktor Petersson","speaker_id":0},{"sentence":"So let's talk about some ZFF fundamentals.","startTime":"41:53","endTime":"41:56","speaker_name":"Viktor Petersson","speaker_id":0},{"sentence":"Like, you obviously is an authority on CFS in your day job, and maybe for those not familiar with your day job, do a quick spiel about what you actually spend in your day and why you're spending your day doing CFS work.","startTime":"41:56","endTime":"42:09","speaker_name":"Viktor Petersson","speaker_id":0},{"sentence":"Yeah.","startTime":"42:09","endTime":"42:10","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"So back in 2018, I founded a company called Clara, which is clarasystems.com and we provide professional development and support services around FreeBSD and ZFS, including ZFS and Linux.","startTime":"42:10","endTime":"42:24","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"And so customers come to us when they hit a bug in ZFS and need help with it.","startTime":"42:24","endTime":"42:29","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"We sell support subscriptions, and we develop new ZFS features.","startTime":"42:29","endTime":"42:33","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"So, for example, we developed a feature to be able to delegate a ZFS data set into an LXD container on Ubuntu so that one of our customers could run unprivileged Docker inside a container, but using ZFS so that Docker would be able to use ZFS snapshots and so on.","startTime":"42:33","endTime":"42:51","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"So when they give, they take your pool in zfs, and in zfs you can have.","startTime":"42:51","endTime":"42:56","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"So it combines all those hard drives you have into one pool of storage, which you can build multiple file systems that share the free space.","startTime":"42:56","endTime":"43:05","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"So you don't have the problem of partitioning you used to have.","startTime":"43:05","endTime":"43:07","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"If you had a 20 terabyte hard drive and you decide, okay, I'm going to Split this into four 5 terabyte partitions and run the five different workloads on them, and suddenly one of them is only using 1 TB, the other one would like to use 6.","startTime":"43:08","endTime":"43:20","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"But now that's not where your partitions are.","startTime":"43:20","endTime":"43:22","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"And you have this problem of like, oh, I don't have enough space over here, but too much space over here.","startTime":"43:22","endTime":"43:27","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"By pooling your storage in zfs, it means that you can just use all the space where you need it, and so you can create one of these virtual file systems and then give it to a container.","startTime":"43:27","endTime":"43:37","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"And inside that container, the fake root user can only see that one and none of the rest.","startTime":"43:37","endTime":"43:42","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"So they use this to run a CI system for many different customers.","startTime":"43:43","endTime":"43:46","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"So each Docker workload runs inside a container and can't see the other ones, but does have access to actually create and destroy snapshots and clones and do all the stuff Docker needs to do to run really quickly, taking advantage of the copyright features of zfs.","startTime":"43:47","endTime":"44:02","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"And so, yeah, they came to us needing this.","startTime":"44:03","endTime":"44:05","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"We developed it and then we also upstreamed it, included it by default in OpenZFS.","startTime":"44:06","endTime":"44:12","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"So then when Ubuntu 22.04 came out, it included that feature and they were able to just run stock Ubuntu and have it in production.","startTime":"44:12","endTime":"44:19","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"Very cool.","startTime":"44:20","endTime":"44:21","speaker_name":"Viktor Petersson","speaker_id":0},{"sentence":"So let's talk a bit about fundamentals in zfs, and you kind of alluded to already, I mentioned pools.","startTime":"44:21","endTime":"44:28","speaker_name":"Viktor Petersson","speaker_id":0},{"sentence":"There are like three building blocks.","startTime":"44:28","endTime":"44:30","speaker_name":"Viktor Petersson","speaker_id":0},{"sentence":"I guess they're V devs, pools and data sets.","startTime":"44:30","endTime":"44:34","speaker_name":"Viktor Petersson","speaker_id":0},{"sentence":"Right.","startTime":"44:34","endTime":"44:34","speaker_name":"Viktor Petersson","speaker_id":0},{"sentence":"And let's Speak a bit.","startTime":"44:34","endTime":"44:36","speaker_name":"Viktor Petersson","speaker_id":0},{"sentence":"Well, maybe the fourth one that I'm not that I'm missing, but let's speak about the fundamentals there.","startTime":"44:36","endTime":"44:40","speaker_name":"Viktor Petersson","speaker_id":0},{"sentence":"So he's like, get big data way.","startTime":"44:40","endTime":"44:42","speaker_name":"Viktor Petersson","speaker_id":0},{"sentence":"Yeah.","startTime":"44:43","endTime":"44:43","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"So like we said, ZFS is a volume manager, so it can also basically do the RAID for you.","startTime":"44:43","endTime":"44:49","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"And so a V dev is one of your kind of RAID components.","startTime":"44:49","endTime":"44:54","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"So you take all the hard drives you have and then you can combine them in groups called V devs, and that V dev can have a transform on it that makes it do something.","startTime":"44:54","endTime":"45:02","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"So if you have no transform, you just have each disk as a separate V device, you've basically done a RAID zero, and it means if you lose any drive, all your data is gone, and that's bad.","startTime":"45:03","endTime":"45:13","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"So you can do a mirror V dev where you're going to have pairs of disks and each display every block you write to some disk.","startTime":"45:14","endTime":"45:23","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"The second disk in that mirror is going to have an exact copy of it.","startTime":"45:23","endTime":"45:26","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"And we'll come back to why ZFS does that better, using checksums in a minute.","startTime":"45:26","endTime":"45:31","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"But then it also has what it calls Raidz 1, which is when you combine any number of drives in a group and it can withstand the loss of any one drive and keep working.","startTime":"45:32","endTime":"45:42","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"That's the same as a raid 5, except for it has one slight advantage.","startTime":"45:43","endTime":"45:47","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"So with raid 5, there's this flaw called the write hole.","startTime":"45:47","endTime":"45:53","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"Whereas when you update something, it's going to write the new data to the hard drive, and then it has to write to a different hard drive the updated parity, so that if it loses that drive using the parity and the other rows on the remaining hard drives, it can calculate what that.","startTime":"45:53","endTime":"46:09","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"What data was on that missing drive.","startTime":"46:09","endTime":"46:11","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"Basically, it adds up the chunks of all of the drives together and gets a value and writes that in the parity.","startTime":"46:11","endTime":"46:17","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"And then if one drive is missing, it can take that thing, subtract what's on every other drive, and get back the value that would have been on the missing hard drive.","startTime":"46:17","endTime":"46:25","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"But because it updates the data one hard drive and then updates the parity separately, if the power goes out between those two steps, then the parity is wrong, but the RAID controller doesn't know it.","startTime":"46:26","endTime":"46:40","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"And so when it boots up, it takes that parity, subtracts the remaining drives, and gets back the wrong answer.","startTime":"46:41","endTime":"46:47","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"And so now the block you just wrote, isn't there some gibberishes, which is a combination of the new data and the old parity?","startTime":"46:47","endTime":"46:54","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"Right, Because ZFS is transactional, it doesn't have that problem.","startTime":"46:55","endTime":"46:58","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"And we'll get back to how that works in a second.","startTime":"46:58","endTime":"47:00","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"But it also has Raid Z2, which means you combine a bunch of drives and any two drives can go missing and it works.","startTime":"47:01","endTime":"47:07","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"So that's like Raid 6.","startTime":"47:07","endTime":"47:09","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"That's available on some hardware controllers.","startTime":"47:10","endTime":"47:12","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"And how many drives do you need for all of these?","startTime":"47:12","endTime":"47:15","speaker_name":"Viktor Petersson","speaker_id":0},{"sentence":"Well, V devs, I guess.","startTime":"47:15","endTime":"47:16","speaker_name":"Viktor Petersson","speaker_id":0},{"sentence":"How many V devs do you need for each of these to work?","startTime":"47:16","endTime":"47:18","speaker_name":"Viktor Petersson","speaker_id":0},{"sentence":"I mean, let's call V dev a physical drive, I presume in most practical use cases.","startTime":"47:18","endTime":"47:22","speaker_name":"Viktor Petersson","speaker_id":0},{"sentence":"So technically the V dev is generally the transform the group of a bunch of physical drives, right?","startTime":"47:23","endTime":"47:27","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"Right.","startTime":"47:27","endTime":"47:28","speaker_name":"Viktor Petersson","speaker_id":0},{"sentence":"So for a raid Z1, technically you need at least two drives, one and the parity.","startTime":"47:28","endTime":"47:35","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"Although it doesn't make sense to do that with less than 3, because you might as well just do a mirror if you only have two.","startTime":"47:35","endTime":"47:40","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"Yeah, and the same with Raidz 2.","startTime":"47:40","endTime":"47:44","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"Technically you only need three drives, but it probably doesn't make sense with fewer than four.","startTime":"47:44","endTime":"47:48","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"One of the big additions that ZFS has is Raid Z3, which allows you to group together some drives and lose any three of them and keep going.","startTime":"47:50","endTime":"47:58","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"That isn't something any hardware RAID controller I know of can actually do.","startTime":"47:58","endTime":"48:03","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"And I may have limited two.","startTime":"48:03","endTime":"48:05","speaker_name":"Viktor Petersson","speaker_id":0},{"sentence":"All you would need technically is four, but you'd probably want six or more for it to make sense where you're going to lose half of them and keep it.","startTime":"48:05","endTime":"48:14","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"Because the big thing is, out of that set, whatever the number is, 1, 2 or 3, that many of the drives basically not going to be used to store your data.","startTime":"48:14","endTime":"48:24","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"It's just going to store the parity to be able to reconstruct the data.","startTime":"48:24","endTime":"48:27","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"Yeah.","startTime":"48:27","endTime":"48:27","speaker_name":"Viktor Petersson","speaker_id":0},{"sentence":"Okay.","startTime":"48:27","endTime":"48:27","speaker_name":"Viktor Petersson","speaker_id":0},{"sentence":"So if you use four drives in a RAID Z3, you're only going to get the space of one hard drive.","startTime":"48:27","endTime":"48:32","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"Right.","startTime":"48:32","endTime":"48:33","speaker_name":"Viktor Petersson","speaker_id":0},{"sentence":"Another thing that's different than most hardware RAID is it doesn't have dedicated parity drives.","startTime":"48:34","endTime":"48:38","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"Right.","startTime":"48:38","endTime":"48:39","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"It's not going to be that, you know, if you have six drives in a Raid Z3, that three of them are only going to contain parity.","startTime":"48:39","endTime":"48:44","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"Z spreads the parity out between the drives so that you get more the bandwidth of the drives when you're writing.","startTime":"48:44","endTime":"48:51","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"So that provides that.","startTime":"48:53","endTime":"48:54","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"And then.","startTime":"48:54","endTime":"48:55","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"So each V dev or group of drives is responsible for its integrity.","startTime":"48:55","endTime":"48:59","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"So it has its own RAID there.","startTime":"48:59","endTime":"49:01","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"But then we combine multiple V devs if you have enough hard drives, and those are basically just striped together.","startTime":"49:02","endTime":"49:08","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"And so if you lose any one V dev, you've broken the whole pool.","startTime":"49:08","endTime":"49:12","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"But, you know, if you've used Raidz 3 in each of your VDEVs then it'll be fine.","startTime":"49:12","endTime":"49:17","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"And so, you know, a big server I built many years ago is basically a petabyte of usable space made up of a bunch of v devs of 12 terabyte hard drives in a RAID Z3.","startTime":"49:17","endTime":"49:30","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"And so I think it was like 9 or 10 of these VDEVs.","startTime":"49:30","endTime":"49:34","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"And that way you get all this space and, you know, as long as you don't lose more than three drives from any group of 12, then everything will be fine.","startTime":"49:34","endTime":"49:45","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"And, you know, when a hard drive dies, you replace it with a new one and it rebuilds and you're okay.","startTime":"49:45","endTime":"49:51","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"Right.","startTime":"49:52","endTime":"49:52","speaker_name":"Viktor Petersson","speaker_id":0},{"sentence":"So that provides that's the V dev layer, and then above that you have the pool, which is basically giving you all the usable space of all those drives put together.","startTime":"49:53","endTime":"50:01","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"And it means that out of that you can create these virtual file systems called data sets.","startTime":"50:02","endTime":"50:07","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"And they're the same thing as kind of like an ext4 file system or whatever.","startTime":"50:07","endTime":"50:11","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"And you could have multiple of them, but each one will show up as a dynamic size where basically they are the amount of data they contain plus all the remaining free space in the pool.","startTime":"50:13","endTime":"50:22","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"Right, right.","startTime":"50:22","endTime":"50:23","speaker_name":"Viktor Petersson","speaker_id":0},{"sentence":"So if you have five of these file systems, each one will say that it has 20 terabytes of space left.","startTime":"50:23","endTime":"50:30","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"But if you write to any one of them, all five of them's free space will go down by the amount you changed.","startTime":"50:30","endTime":"50:35","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"So kind of over provisioning in a sentence.","startTime":"50:35","endTime":"50:37","speaker_name":"Viktor Petersson","speaker_id":0},{"sentence":"Yeah, yeah, except for we're not actually lying and saying that we have more on any of them.","startTime":"50:37","endTime":"50:42","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"And as you write stuff to them, the free space on all of them will go down.","startTime":"50:42","endTime":"50:46","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"But as you delete something one of them, the free space on all of them will go back up.","startTime":"50:46","endTime":"50:50","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"Right.","startTime":"50:50","endTime":"50:51","speaker_name":"Viktor Petersson","speaker_id":0},{"sentence":"Unless you have snapshots, which we'll get to in a second.","startTime":"50:51","endTime":"50:53","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"And so that allows you to have different settings on each data set as well.","startTime":"50:55","endTime":"50:59","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"So ZFS has a feature called transparent compression, where you can set compression on the data set that contains my home directory, but not the dataset that contains my music or something.","startTime":"51:00","endTime":"51:10","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"Right.","startTime":"51:10","endTime":"51:11","speaker_name":"Viktor Petersson","speaker_id":0},{"sentence":"And what this is, as you write the data to ZFS, it will use a fast compressor like LZ4 or Zstandard to shrink the size of those.","startTime":"51:12","endTime":"51:21","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"And then on disk, it'll actually store the compressed version, and then when you read the file back, it'll decompress it first before it gives it to you.","startTime":"51:22","endTime":"51:28","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"So the application doesn't have to know that there's compression happening, but the file system takes care of it for you.","startTime":"51:28","endTime":"51:34","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"And then all your, you know, the Many, many copies of the ZFS source code I have on my server take a lot less space because source code is text and compresses really well.","startTime":"51:34","endTime":"51:44","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"Right.","startTime":"51:44","endTime":"51:45","speaker_name":"Viktor Petersson","speaker_id":0},{"sentence":"And what's overhead?","startTime":"51:45","endTime":"51:47","speaker_name":"Viktor Petersson","speaker_id":0},{"sentence":"Let's talk about compression for a second, because I think that's a super interesting one.","startTime":"51:47","endTime":"51:50","speaker_name":"Viktor Petersson","speaker_id":0},{"sentence":"Like what's the.","startTime":"51:50","endTime":"51:51","speaker_name":"Viktor Petersson","speaker_id":0},{"sentence":"On a modern server, let's talk about ZZ standard, like a basic compression or the basic one, I think, in ZPass.","startTime":"51:51","endTime":"51:58","speaker_name":"Viktor Petersson","speaker_id":0},{"sentence":"What's the overhead, CPU wise, I presume would be the big impact.","startTime":"51:59","endTime":"52:03","speaker_name":"Viktor Petersson","speaker_id":0},{"sentence":"Right?","startTime":"52:03","endTime":"52:04","speaker_name":"Viktor Petersson","speaker_id":0},{"sentence":"Right.","startTime":"52:04","endTime":"52:04","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"So that's the interesting.","startTime":"52:04","endTime":"52:05","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"With LZ4, the overhead is quite minimal.","startTime":"52:05","endTime":"52:09","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"It can compress multiple gigabytes per second per core.","startTime":"52:09","endTime":"52:13","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"So as long as you have a couple of cores, you're probably going to run out of performance on your storage, even if it's NVME before you run out of CPU time.","startTime":"52:13","endTime":"52:21","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"Interesting.","startTime":"52:21","endTime":"52:22","speaker_name":"Viktor Petersson","speaker_id":0},{"sentence":"And it can actually end up being faster because if you have 100 gigabytes of source code you're trying to or 100 megabytes of source code you're trying to write, and a regular spinning hard drive that can write 100 megabytes per second, then it would take you a second to save that 100 megabytes of source code.","startTime":"52:23","endTime":"52:39","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"If you can compress it at 2 gigabytes per second, so it takes a fraction of the second to compress it, and it compresses down to 50 megabytes, you write it to the hard drive and it only took half a second.","startTime":"52:39","endTime":"52:52","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"So it means technically, if you had more source code, you could write 200 megabytes a second to this hard drive if your compression ratio is 2x.","startTime":"52:53","endTime":"53:00","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"So in exchange for a little bit of CPU time, you could make your hard drive seem faster only if the data is actually compressible.","startTime":"53:01","endTime":"53:08","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"And the same thing applies when you read.","startTime":"53:08","endTime":"53:10","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"Now, when you read, you only have to read 50 megabytes in order to read all 100 megabytes of the data.","startTime":"53:10","endTime":"53:16","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"And LZ4 decompresses at over 10 gigabytes per second per core.","startTime":"53:16","endTime":"53:20","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"Right.","startTime":"53:21","endTime":"53:21","speaker_name":"Viktor Petersson","speaker_id":0},{"sentence":"And so it can end up making a lot of workloads faster.","startTime":"53:22","endTime":"53:25","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"Interesting.","startTime":"53:26","endTime":"53:26","speaker_name":"Viktor Petersson","speaker_id":0},{"sentence":"Are there any?","startTime":"53:26","endTime":"53:27","speaker_name":"Viktor Petersson","speaker_id":0},{"sentence":"Because I believe compression is disabled by default.","startTime":"53:28","endTime":"53:31","speaker_name":"Viktor Petersson","speaker_id":0},{"sentence":"So as of version I think 2.2 compression is on by default.","startTime":"53:31","endTime":"53:35","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"Okay, it's now to the point where it's so fast it doesn't have a penalty if you try to Compress things like MP3s or video files that are uncompressible or even encrypted files.","startTime":"53:35","endTime":"53:48","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"Computers are so fast now that it basically doesn't have a high enough cost.","startTime":"53:49","endTime":"53:53","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"Right.","startTime":"53:53","endTime":"53:54","speaker_name":"Viktor Petersson","speaker_id":0},{"sentence":"There's also a feature in ZFS called Early Abort where it can notice.","startTime":"53:54","endTime":"53:57","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"I've been compressing this chunk for a little bit and I noticed that it's not compressing enough that it's going to be smaller enough to matter.","startTime":"53:58","endTime":"54:06","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"Basically if it's not going to save you at least 12% if it becomes obvious we stop and don't finish trying and just store it uncompressed.","startTime":"54:06","endTime":"54:14","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"Okay, so there's like.","startTime":"54:14","endTime":"54:15","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"Okay, interesting.","startTime":"54:15","endTime":"54:16","speaker_name":"Viktor Petersson","speaker_id":0},{"sentence":"Yeah.","startTime":"54:16","endTime":"54:16","speaker_name":"Viktor Petersson","speaker_id":0},{"sentence":"Because I mean if you are chucking compressed files on the compressed compressor, that's not going to make much.","startTime":"54:16","endTime":"54:21","speaker_name":"Viktor Petersson","speaker_id":0},{"sentence":"Yeah, that's just going to happen.","startTime":"54:21","endTime":"54:22","speaker_name":"Viktor Petersson","speaker_id":0},{"sentence":"It's just going to use up a bunch of CPU time.","startTime":"54:22","endTime":"54:24","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"Now LZ4 is so cheap it doesn't make a big difference, but it will also notice and give up early in order to save some of that CPU time.","startTime":"54:24","endTime":"54:31","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"Right, okay, so there's what you're saying essentially there is no reason not to use it.","startTime":"54:31","endTime":"54:36","speaker_name":"Viktor Petersson","speaker_id":0},{"sentence":"Exactly.","startTime":"54:36","endTime":"54:37","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"It's now to the point where you might as well just have LZ4 on everywhere and it will help you where it can and it won't make a big difference where it doesn't help.","startTime":"54:37","endTime":"54:44","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"Right.","startTime":"54:44","endTime":"54:45","speaker_name":"Viktor Petersson","speaker_id":0},{"sentence":"I would imagine back in the early days that was quite not the case.","startTime":"54:45","endTime":"54:48","speaker_name":"Viktor Petersson","speaker_id":0},{"sentence":"Right.","startTime":"54:48","endTime":"54:48","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"Well, especially before LZ4 there was only basically LZMA which wasn't or not LZGB which wasn't as good.","startTime":"54:48","endTime":"54:57","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"And gzip.","startTime":"54:57","endTime":"54:59","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"And gzip can compress better, but it is slow.","startTime":"54:59","endTime":"55:02","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"Like gzip will top out at like 50 or 100 megabytes per second per core.","startTime":"55:03","endTime":"55:07","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"And yes, that will you will run out of CPU before you run out of storage bandwidth.","startTime":"55:07","endTime":"55:11","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"So gzip will really hurt you.","startTime":"55:12","endTime":"55:14","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"As far as CPU usage, Z standard supports 19 different levels in ZFS and so you can tune it from only use a bit of the CPU to use all the CPU.","startTime":"55:14","endTime":"55:24","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"But if you use up to 19, it will only compress at like a single digit megabytes per second.","startTime":"55:24","endTime":"55:30","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"So you only want to use that one when it's like I'm writing this once, I know it's compressible and I'm just going to keep it forever.","startTime":"55:30","endTime":"55:36","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"And it'll be worth it to spend the CPU time to compress it that much.","startTime":"55:36","endTime":"55:41","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"Right.","startTime":"55:41","endTime":"55:42","speaker_name":"Viktor Petersson","speaker_id":0},{"sentence":"But we also added a feature I think in 2.2 or 2.3 where if you enable a really high Z standard level, it will quickly try to compress it with LZ4 first and see if LZ4 couldn't compress it, we assume Z standard won't be able to compress it and we just won't even try.","startTime":"55:42","endTime":"55:59","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"Whereas if it does compress it, then we'll let it.","startTime":"55:59","endTime":"56:01","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"And so it allows you to skip trying the heavy compression on files that are definitely not compressible, again to avoid the overhead and let you just kind of turn it on without having to worry that it's going to spend a lot of time trying to compress things that aren't important or not compressible.","startTime":"56:01","endTime":"56:18","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"Right.","startTime":"56:18","endTime":"56:19","speaker_name":"Viktor Petersson","speaker_id":0},{"sentence":"Okay, so we talk about data sets.","startTime":"56:19","endTime":"56:20","speaker_name":"Viktor Petersson","speaker_id":0},{"sentence":"One thing about datasets that I found important is that you can run encrypted datasets on top of a pool.","startTime":"56:21","endTime":"56:27","speaker_name":"Viktor Petersson","speaker_id":0},{"sentence":"Right.","startTime":"56:27","endTime":"56:27","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"So you could have non encrypted or you could have some encrypted, Maybe speak a bit about how that works because that's kind of a relatively unique feature as well to zfs.","startTime":"56:27","endTime":"56:35","speaker_name":"Viktor Petersson","speaker_id":0},{"sentence":"Yeah, so most block level systems have some kind of encryption.","startTime":"56:35","endTime":"56:41","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"So on Linux there's lux and on FreeBSD there's Gelly.","startTime":"56:41","endTime":"56:44","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"And these use an algorithm called aesxts, which is whole disk encryption, and they use a key and they encrypt the data on the disk.","startTime":"56:44","endTime":"56:52","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"With zfs, we wanted more granularity.","startTime":"56:54","endTime":"56:58","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"So yeah, we have these multiple different data sets.","startTime":"56:58","endTime":"57:00","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"And maybe I want my operating system non encrypted so it's easier to boot from and so on, but I want my home directory encrypted.","startTime":"57:00","endTime":"57:07","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"And so it uses AES gcm, which is the encryption normally used for like HTTPs, and it encrypts not the structural information.","startTime":"57:08","endTime":"57:20","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"So like the name of the data set and the ZFS specific bits are not encrypted because it needs to be able to work on those.","startTime":"57:20","endTime":"57:26","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"But basically the file names and the actual data in the files are all encrypted.","startTime":"57:26","endTime":"57:31","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"And so earlier we mentioned the checksum.","startTime":"57:33","endTime":"57:37","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"So ZFS stores a checksum of every block so they can verify that the block didn't get corrupted by your hard drive.","startTime":"57:37","endTime":"57:42","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"Or as we mentioned, when you're doing a mirror in traditional mirroring with hardware, RAID or md, RAID and so on, if the two sides of the mirror don't match, there's no way to tell which one is right and which one's wrong.","startTime":"57:43","endTime":"57:55","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"Yeah, instead of S, because we store a checksum separate from the data, we can read both pieces of data and see which one matches the checksum and know, oh, the SHA256 says copy two is the right one.","startTime":"57:56","endTime":"58:06","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"And so we'll repair copy one with the right copy.","startTime":"58:06","endTime":"58:10","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"When we encrypt files we split that checksum in half.","startTime":"58:11","endTime":"58:14","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"We keep the first half of the SHA256.","startTime":"58:14","endTime":"58:17","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"And in the second half, we keep the message authentication code from the encryption.","startTime":"58:17","endTime":"58:22","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"This allows us to verify both bits, the raw encrypted data on disk, that it's not corrupted.","startTime":"58:23","endTime":"58:30","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"And the Mac ensures that when we decrypt the data, we got the right data back and that it hasn't been tampered with.","startTime":"58:30","endTime":"58:35","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"This means that unlike whole disk encryption, where if you mount the file system, you have to have entered the decryption key and now everything's decrypted.","startTime":"58:36","endTime":"58:45","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"With zfs, if you have your home directory and somebody else's home directory, those are encrypted with different keys.","startTime":"58:46","endTime":"58:52","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"And when the other user is not logged in, they can unload their key and that data is actually at rest and encrypted and can't be accessed by anybody until they come and enter the key, maybe by logging in over SSH and using their passphrase.","startTime":"58:52","endTime":"59:04","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"And so that allows that data to actually be protected.","startTime":"59:06","endTime":"59:08","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"Whereas if you just used whole hard drive encryption, that really only protects you against somebody stealing the physical machine.","startTime":"59:08","endTime":"59:14","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"And then when they reboot and try to access it, they don't have the key and they can't decrypt the hard drive.","startTime":"59:14","endTime":"59:18","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"Whereas with zfs, you can unload this key.","startTime":"59:18","endTime":"59:21","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"And now nobody can access this data without entering the key first.","startTime":"59:21","endTime":"59:25","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"So it allows you to keep the data at rest and have the protection from encryption without having to power off the server to get the protection.","startTime":"59:26","endTime":"59:35","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"Right.","startTime":"59:35","endTime":"59:36","speaker_name":"Viktor Petersson","speaker_id":0},{"sentence":"But importantly, because we split that checksum in two, it means that we can still run the repair of a failed hard drive on the encrypted data without needing the encryption key.","startTime":"59:37","endTime":"59:50","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"Oh, right, okay.","startTime":"59:50","endTime":"59:51","speaker_name":"Viktor Petersson","speaker_id":0},{"sentence":"And so it can, it knows from the first half the checksum that, hey, that block is not right.","startTime":"59:51","endTime":"59:57","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"The hard drive flipped a bit or something and, or, you know, we've drive failed and we put in a new one and we can rebuild all the data and get the array back healthy without ever having to have the encryption key.","startTime":"59:57","endTime":"01:00:09","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"So it means the storage administrator doesn't need all the encryption keys, which was a big advantage.","startTime":"01:00:09","endTime":"01:00:14","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"Right.","startTime":"01:00:14","endTime":"01:00:15","speaker_name":"Viktor Petersson","speaker_id":0},{"sentence":"So a use case that came up with this for one of our customers being a law firm was, you know, we have all this discovery evidence from a case.","startTime":"01:00:15","endTime":"01:00:22","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"The case is now over.","startTime":"01:00:22","endTime":"01:00:24","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"We have to destroy that evidence and not have a copy of it anymore.","startTime":"01:00:24","endTime":"01:00:28","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"But, you know, we can't be sure that our flash drives are actually going to erase anything we erase.","startTime":"01:00:28","endTime":"01:00:33","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"So overriding is not necessarily going to be good enough.","startTime":"01:00:34","endTime":"01:00:36","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"And if we use whole disk encryption, we'd have to Reformat the whole hard drive in order to actually ensure that it's gone.","startTime":"01:00:36","endTime":"01:00:42","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"But by having a different encryption key for each case's data set, they can just unmount it, destroy the key and never be able.","startTime":"01:00:43","endTime":"01:00:49","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"That data is not recoverable now, and it makes their life much easier for doing that.","startTime":"01:00:50","endTime":"01:00:55","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"So you mentioned two types of, I guess, unlocking.","startTime":"01:00:55","endTime":"01:00:59","speaker_name":"Viktor Petersson","speaker_id":0},{"sentence":"There's the key and there's the passphrase.","startTime":"01:00:59","endTime":"01:01:01","speaker_name":"Viktor Petersson","speaker_id":0},{"sentence":"One thing that at least I've been bothered with, both in the Linux world and in the BSD world, I guess, is that in most other operating systems you can use a TPM to unlock and lock and do disk encryption.","startTime":"01:01:02","endTime":"01:01:15","speaker_name":"Viktor Petersson","speaker_id":0},{"sentence":"That is not quite the case.","startTime":"01:01:15","endTime":"01:01:17","speaker_name":"Viktor Petersson","speaker_id":0},{"sentence":"It's kind of possible on Linux.","startTime":"01:01:17","endTime":"01:01:19","speaker_name":"Viktor Petersson","speaker_id":0},{"sentence":"I don't know how it is in the BSD world, but do you want to say a few words about the narrative around that?","startTime":"01:01:19","endTime":"01:01:25","speaker_name":"Viktor Petersson","speaker_id":0},{"sentence":"If that's something that is being worked on or particular encryption, I guess, yeah.","startTime":"01:01:25","endTime":"01:01:32","speaker_name":"Viktor Petersson","speaker_id":0},{"sentence":"I've not really looked at the full disk encryption stuff in a while because I've been more focused on zfs.","startTime":"01:01:32","endTime":"01:01:37","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"But I did do support for the full disk encryption in FreeBSD's bootloader years ago.","startTime":"01:01:37","endTime":"01:01:43","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"So yeah, there is interest in doing the tpm.","startTime":"01:01:45","endTime":"01:01:47","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"So what ZFS has right now is you can load the key basically by typing it in by having a path to a file or having a URL to like an API.","startTime":"01:01:47","endTime":"01:01:57","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"So you can actually have, as the machines boot up, they call some other machine to say, hey, it proves with a certificate or something that I'm part of your network.","startTime":"01:01:58","endTime":"01:02:08","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"And that server says, okay, here's the key to decrypt that data.","startTime":"01:02:08","endTime":"01:02:11","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"So you type it in.","startTime":"01:02:11","endTime":"01:02:12","speaker_name":"Viktor Petersson","speaker_id":0},{"sentence":"Yeah, but we would definitely be interested in using the TPM to store the key material.","startTime":"01:02:14","endTime":"01:02:21","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"Just no one's come with that use case.","startTime":"01:02:22","endTime":"01:02:24","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"So if you would like ZFS whole disk or dataset encryption to use the TPM, then definitely go to Cloudystems.com and click on the ZFS button and tell us you want that feature and we'll talk to you and definitely get that built because there's some interest in it.","startTime":"01:02:24","endTime":"01:02:40","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"We just would need somebody who has a commercial interest in it.","startTime":"01:02:40","endTime":"01:02:43","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"Yeah, no, I had a more personal interest.","startTime":"01:02:43","endTime":"01:02:46","speaker_name":"Viktor Petersson","speaker_id":0},{"sentence":"I use ZFS on my Just Home server, my Boxbox server.","startTime":"01:02:46","endTime":"01:02:54","speaker_name":"Viktor Petersson","speaker_id":0},{"sentence":"And just when you reboot the server and you have to manually type in a passphrase and you don't have a KVM or something hooked up to it, that is a pain point, right?","startTime":"01:02:54","endTime":"01:03:02","speaker_name":"Viktor Petersson","speaker_id":0},{"sentence":"Yeah, exactly.","startTime":"01:03:02","endTime":"01:03:03","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"And that's why some people use that HTTP thing to fetch the key from another machine that's going to have stayed up, hopefully, or whatever, some kind of zero trust environment where before you can have this encryption key, you have to prove that you're not a compromised machine and you're the machine that's supposed to have this decryption key and so on.","startTime":"01:03:03","endTime":"01:03:21","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"Yeah, exactly.","startTime":"01:03:21","endTime":"01:03:23","speaker_name":"Viktor Petersson","speaker_id":0},{"sentence":"Cool.","startTime":"01:03:23","endTime":"01:03:24","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"We talked a bit about what we kind of alluded to, scrubbing.","startTime":"01:03:24","endTime":"01:03:27","speaker_name":"Viktor Petersson","speaker_id":0},{"sentence":"I guess maybe you should just knock that out as well, what scrubbing is and how it's different than other profile systems.","startTime":"01:03:27","endTime":"01:03:32","speaker_name":"Viktor Petersson","speaker_id":0},{"sentence":"Right.","startTime":"01:03:32","endTime":"01:03:33","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"So that kind of depends on checksumming.","startTime":"01:03:33","endTime":"01:03:35","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"So as ZFS writes, any block of data you give it stores.","startTime":"01:03:35","endTime":"01:03:40","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"So in the indirect block where it actually says, you know, the fifth megabyte of that file is on this offset on disk, it has information about it like when we wrote it and the checksum.","startTime":"01:03:41","endTime":"01:03:52","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"And so a scrub is basically a patrol read where it goes through your whole disk and reads every block and checks that the checksum is still what it's supposed to be.","startTime":"01:03:53","endTime":"01:04:02","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"And so this allows it to detect bit flips on your hard drive or bitrod or any kind of corruption.","startTime":"01:04:02","endTime":"01:04:07","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"And so ZFS scans all the data and makes sure that the checksums are correct and fixes them.","startTime":"01:04:08","endTime":"01:04:13","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"They aren't.","startTime":"01:04:13","endTime":"01:04:14","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"Because if you have bitrot, it usually kind of.","startTime":"01:04:14","endTime":"01:04:17","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"It's creeping.","startTime":"01:04:17","endTime":"01:04:17","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"It starts small and gets bigger and bigger.","startTime":"01:04:18","endTime":"01:04:19","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"So when you catch it and fix it means that, you know, if you have a RAID Z2 where you have, you know, eight hard drives and two of them are providing parity, if you find a bit flip and fix it, when you find the second bit flip and fix it, you had all the data you need to reconstruct it.","startTime":"01:04:20","endTime":"01:04:36","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"Whereas eventually, if you had three bit flips, you wouldn't have enough data to fix it if all three were in the same file.","startTime":"01:04:36","endTime":"01:04:42","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"But if you once a month are reading all the data, making sure the checksum is correct, it means you fix each of those errors as they come up and they don't accumulate to the point where you actually have data.","startTime":"01:04:43","endTime":"01:04:54","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"Right.","startTime":"01:04:54","endTime":"01:04:55","speaker_name":"Viktor Petersson","speaker_id":0},{"sentence":"Yeah.","startTime":"01:04:55","endTime":"01:04:55","speaker_name":"Viktor Petersson","speaker_id":0},{"sentence":"I had Brian Kantra from Oxide on the show a few episodes ago, and he was giving some story from Illuminus when they were running that, and how they discovered driver issues and issues with IO controllers, essentially where they basically was, because of the intelligence of zfs, they were able to pick up things that otherwise would have gone undercover.","startTime":"01:04:55","endTime":"01:05:15","speaker_name":"Viktor Petersson","speaker_id":0},{"sentence":"Really?","startTime":"01:05:15","endTime":"01:05:15","speaker_name":"Viktor Petersson","speaker_id":0},{"sentence":"Yeah.","startTime":"01:05:15","endTime":"01:05:16","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"And we've hit similar cases.","startTime":"01:05:16","endTime":"01:05:17","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"We had one customer using like an early version of an all Flash array, and occasionally ZFS was finding this corruption.","startTime":"01:05:17","endTime":"01:05:24","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"And it turned out there had been A firmware bug and a rounding error or something meant that certain writes would get written to the wrong place.","startTime":"01:05:24","endTime":"01:05:31","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"So when you read from the right place, the data wasn't there.","startTime":"01:05:31","endTime":"01:05:34","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"And when you read what was supposed to be at the wrong place, it had been overwritten with this other data.","startTime":"01:05:34","endTime":"01:05:40","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"And ZFS was able to point it out and we eventually found the pattern and they were able to fix the firmware.","startTime":"01:05:40","endTime":"01:05:45","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"Nice.","startTime":"01:05:45","endTime":"01:05:46","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"Snapshotting is not a thing you've hinted at.","startTime":"01:05:47","endTime":"01:05:49","speaker_name":"Viktor Petersson","speaker_id":0},{"sentence":"Yes, the really interesting one.","startTime":"01:05:50","endTime":"01:05:52","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"So other file systems in the past have had snapshotting like you think of.","startTime":"01:05:52","endTime":"01:05:55","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"Even KVM with Qcow2 has this concept of snapshotting.","startTime":"01:05:55","endTime":"01:05:59","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"But in other file systems, the way snapshotting worked is, you know, you have your normal file system, when you change a file, we just overwrite it in place.","startTime":"01:05:59","endTime":"01:06:06","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"But if snapshotting is enabled, then we'll detect that and we'll, oh, write the new change to a different place instead and keep both versions.","startTime":"01:06:07","endTime":"01:06:14","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"So that meant there was this cost.","startTime":"01:06:14","endTime":"01:06:16","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"So like, if you use the snapshots in lvm, as soon as you have one snapshot, your performance gets cut like in half.","startTime":"01:06:16","endTime":"01:06:21","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"And then you have a second snapshot and it's half of that.","startTime":"01:06:21","endTime":"01:06:24","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"And so if you have like eight snapshots, you're at like, you know, 10% of your original performance.","startTime":"01:06:24","endTime":"01:06:28","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"It's pretty terrible.","startTime":"01:06:28","endTime":"01:06:29","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"With ZFS, it works differently.","startTime":"01:06:30","endTime":"01:06:32","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"Every time we make a change to a file, an existing file, we always write the blocks to a new place.","startTime":"01:06:33","endTime":"01:06:38","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"If you have no snapshots, the old place after a couple of seconds just becomes free space and can be reused later.","startTime":"01:06:39","endTime":"01:06:45","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"But if we have a snapshot, then we know to keep that data.","startTime":"01:06:45","endTime":"01:06:50","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"So basically I mentioned one of the bits of metadata we have along with the checksum is the time when the block was written.","startTime":"01:06:50","endTime":"01:06:56","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"And this is measured in transaction groups since the pool was created.","startTime":"01:06:57","endTime":"01:07:00","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"So when you create a snapshot, it's mostly just remembering the time of the snapshot.","startTime":"01:07:00","endTime":"01:07:04","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"And so when you overwrite some data, if it's before that snapshot, then we need to keep it, and so it won't erase it and it'll just keep going.","startTime":"01:07:04","endTime":"01:07:15","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"So it means when you're writing while having snapshots or reading, there's no extra work to do.","startTime":"01:07:15","endTime":"01:07:20","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"We're actually doing less work because we're not freeing that space because it's referenced by the snapshot.","startTime":"01:07:20","endTime":"01:07:26","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"Then later when you delete the snapshot, it can go through and say anything that's older than the now oldest snapshot.","startTime":"01:07:26","endTime":"01:07:33","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"We don't necessarily need that anymore.","startTime":"01:07:34","endTime":"01:07:36","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"And so it can go and free it and make the free space.","startTime":"01:07:36","endTime":"01:07:39","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"That's very cool.","startTime":"01:07:39","endTime":"01:07:40","speaker_name":"Viktor Petersson","speaker_id":0},{"sentence":"So the copy and write nature of ZFS also provides the other big thing.","startTime":"01:07:40","endTime":"01:07:44","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"Especially in the early 2000s, there was this problem where if your server ever got rebooted unexpectedly, when it came back up, it had to run an FSCK and check all the stuff to make sure your directories weren't corrupt or whatever.","startTime":"01:07:44","endTime":"01:07:56","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"Yeah, on bigger hard drives that could take days.","startTime":"01:07:56","endTime":"01:08:00","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"And have your operating system not fully running for days was not an option.","startTime":"01:08:00","endTime":"01:08:04","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"Eventually that was mostly kind of solved with journaling, but to a limited degree with zfs.","startTime":"01:08:04","endTime":"01:08:10","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"The way it works is using those transactions.","startTime":"01:08:11","endTime":"01:08:13","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"Any changes you make get accumulated in a transaction group and then written out.","startTime":"01:08:14","endTime":"01:08:17","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"And by default that happens every five seconds or more frequently if you're pushing a lot of data and it's getting full.","startTime":"01:08:17","endTime":"01:08:25","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"But this means that, you know, in an overriding file system, if you're in the, you know, just made a bunch of changes to a big Excel file and hit save and the power goes out halfway through saving.","startTime":"01:08:28","endTime":"01:08:38","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"On a regular file system, you would have overwritten the first half of the original copy of the program or the Excel file with the new version, but the second half didn't get written yet because the power went out.","startTime":"01:08:39","endTime":"01:08:49","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"So when you boot back up, you have half the new file and half the old file.","startTime":"01:08:49","endTime":"01:08:52","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"And correl Excel is just going to say, that's gibberish.","startTime":"01:08:52","endTime":"01:08:55","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"I can't make sense of that.","startTime":"01:08:55","endTime":"01:08:57","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"Whereas zfs, the new file was being written over here and we only have half of it.","startTime":"01:08:58","endTime":"01:09:04","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"And so that transaction didn't finish, so the checksum won't match.","startTime":"01:09:04","endTime":"01:09:07","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"So when it boots up, it'll just say, okay, that one didn't finish.","startTime":"01:09:07","endTime":"01:09:10","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"We'll go back to one previous that is completed and do that.","startTime":"01:09:10","endTime":"01:09:14","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"And then ZFS has this concept called the ZFS Intent log or zil, where any time an application asks for a promise that the write I just did is on disk before I continue, like a database would, that gets written to the xil and then when you reboot after the crash, the XIL will replay those changes and make sure that everything we promised actually got finished.","startTime":"01:09:14","endTime":"01:09:36","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"Like a wall login postgres.","startTime":"01:09:36","endTime":"01:09:38","speaker_name":"Viktor Petersson","speaker_id":0},{"sentence":"Exactly.","startTime":"01:09:39","endTime":"01:09:39","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"But that for the file system and this way we go from the file system was perfect to the file system was perfect without ever having to be in that in between state.","startTime":"01:09:39","endTime":"01:09:49","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"Because it's in between state, we kind of roll back like a database.","startTime":"01:09:49","endTime":"01:09:51","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"And so it doesn't have this need to fsck.","startTime":"01:09:52","endTime":"01:09:55","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"Other file systems do super interesting.","startTime":"01:09:56","endTime":"01:09:59","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"The last feature that I wanted to cover, which I think is a very neat feature as well, is the ZFS send, which is kind of clever feature as well for like, shipping data across systems, really.","startTime":"01:09:59","endTime":"01:10:09","speaker_name":"Viktor Petersson","speaker_id":0},{"sentence":"So maybe speak a bit about that.","startTime":"01:10:09","endTime":"01:10:10","speaker_name":"Viktor Petersson","speaker_id":0},{"sentence":"Yeah.","startTime":"01:10:11","endTime":"01:10:11","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"So basically it allows you to serialize a file system into a stream that you can send over the network.","startTime":"01:10:11","endTime":"01:10:17","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"Technically, you could send it to a file and then receive it on a different computer much later, but usually it makes more sense to just do it directly, because having a giant file full of a stream of the file system isn't as useful as if you receive it, you have that same amount of space, but as a usable copy of the file system.","startTime":"01:10:17","endTime":"01:10:36","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"Right.","startTime":"01:10:36","endTime":"01:10:37","speaker_name":"Viktor Petersson","speaker_id":0},{"sentence":"But its power really comes from its ability to do incremental replication, where after you've sent the whole file system based on a snapshot, if you make a newer snapshot, you can send the difference just between those two.","startTime":"01:10:38","endTime":"01:10:49","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"And that depends on what we had just talked about, those transactions and the transaction group id.","startTime":"01:10:49","endTime":"01:10:56","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"So when you created the first snapshot, were at, say, transaction 1000, and when you created the second one, were at, say 1100.","startTime":"01:10:56","endTime":"01:11:03","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"So now when you say send the difference between snapshot one and snapshot two, ZFS just has to look for blocks that have a birth time between those two numbers.","startTime":"01:11:04","endTime":"01:11:11","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"Oh, neat.","startTime":"01:11:11","endTime":"01:11:12","speaker_name":"Viktor Petersson","speaker_id":0},{"sentence":"Okay.","startTime":"01:11:12","endTime":"01:11:12","speaker_name":"Viktor Petersson","speaker_id":0},{"sentence":"And so we can just scan all those blocks and say, okay, any block that has a birth time greater than a thousand, but up to 1100, we're just going to feed it into the stream, and on the other side we'll just receive those.","startTime":"01:11:12","endTime":"01:11:24","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"And so compared to doing a backup with something like rsync, where it's going to walk through every single file in your system and run stat on it and be like, when did you last change?","startTime":"01:11:25","endTime":"01:11:34","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"When did you last change?","startTime":"01:11:34","endTime":"01:11:35","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"And only.","startTime":"01:11:35","endTime":"01:11:36","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"And if a file is huge, but it was touched, rsync has to read the whole file on your side and read the whole file on the far side and check the checksum of the chunks and then to figure out which blocks changed.","startTime":"01:11:36","endTime":"01:11:51","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"Whereas ZFS just looks at the time on each block in the metadata without having to read the data and says, okay, only these seven blocks change.","startTime":"01:11:51","endTime":"01:11:59","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"So it just sends those seven blocks and it's done.","startTime":"01:11:59","endTime":"01:12:01","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"Interesting.","startTime":"01:12:02","endTime":"01:12:02","speaker_name":"Viktor Petersson","speaker_id":0},{"sentence":"And so ZFS is able to basically saturate the network and do the backup in a couple of seconds, where Rsync might take a whole day to copy that same couple of blocks, because it has to check every file, and then if the file is newer, it has to read the whole file on both Sides and decide which blocks are actually different.","startTime":"01:12:03","endTime":"01:12:20","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"Whereas ZFS just natively knows because it has a timestamp for each block of the file instead of just the whole file.","startTime":"01:12:20","endTime":"01:12:26","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"Right.","startTime":"01:12:26","endTime":"01:12:26","speaker_name":"Viktor Petersson","speaker_id":0},{"sentence":"And I guess if you send it on a network, you would just pipe it through something that's encrypted and then receive it and decrypt it.","startTime":"01:12:26","endTime":"01:12:31","speaker_name":"Viktor Petersson","speaker_id":0},{"sentence":"Yeah.","startTime":"01:12:31","endTime":"01:12:32","speaker_name":"Viktor Petersson","speaker_id":0},{"sentence":"Okay.","startTime":"01:12:32","endTime":"01:12:32","speaker_name":"Viktor Petersson","speaker_id":0},{"sentence":"Well, also, if your data set was encrypted on zfs, you can do a raw send where it'll send the encrypted version without decrypting it to the other side.","startTime":"01:12:32","endTime":"01:12:42","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"And then that way the data is never decrypted on the far side.","startTime":"01:12:42","endTime":"01:12:46","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"And so if they don't have the key to decrypt it, they only have a backup of your data that they can send back to you, but they can't ever mount.","startTime":"01:12:46","endTime":"01:12:54","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"Right, okay.","startTime":"01:12:54","endTime":"01:12:55","speaker_name":"Viktor Petersson","speaker_id":0},{"sentence":"The thing lots of people are after.","startTime":"01:12:56","endTime":"01:12:58","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"Yeah.","startTime":"01:12:58","endTime":"01:12:58","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"Are there any hosted services I know obviously a fellow Canadian call in is running tarsnap.","startTime":"01:12:58","endTime":"01:13:05","speaker_name":"Viktor Petersson","speaker_id":0},{"sentence":"Are they supporting that ZFS send as torch now?","startTime":"01:13:05","endTime":"01:13:09","speaker_name":"Viktor Petersson","speaker_id":0},{"sentence":"Because that would be an interesting service offer to basically ship.","startTime":"01:13:09","endTime":"01:13:12","speaker_name":"Viktor Petersson","speaker_id":0},{"sentence":"They're not.","startTime":"01:13:12","endTime":"01:13:13","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"So the two services I know of are ZFS Rent, where they will basically rent you a hard drive in a VM that you can do that to and then rsync.net has a thing where they will basically stand up freebies to your Linux in a VM and sell you five terabytes of space that you can ZFS receive your encrypted data sets to.","startTime":"01:13:13","endTime":"01:13:36","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"Or not encrypted if you don't care.","startTime":"01:13:36","endTime":"01:13:38","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"Interesting.","startTime":"01:13:39","endTime":"01:13:40","speaker_name":"Viktor Petersson","speaker_id":0},{"sentence":"All right, so the last thing I want to round up the episode on is Tales from the Trenches.","startTime":"01:13:40","endTime":"01:13:45","speaker_name":"Viktor Petersson","speaker_id":0},{"sentence":"Obviously you've been around the data world for quite some time and I'm sure we've seen a lot of horror stories around this.","startTime":"01:13:45","endTime":"01:13:52","speaker_name":"Viktor Petersson","speaker_id":0},{"sentence":"So I kind of want to hear from your side what's the craziest and more like bizarre data recovery missions you guys been on trying to recover data on GMS clusters or in general?","startTime":"01:13:52","endTime":"01:14:03","speaker_name":"Viktor Petersson","speaker_id":0},{"sentence":"Yeah, we've done quite a few different ones.","startTime":"01:14:03","endTime":"01:14:06","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"We just did a webinar on Halloween that we'll drop a link in here for, but if you go to clarasystems.com and click webinars, you'll find our Halloween horror stories.","startTime":"01:14:07","endTime":"01:14:17","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"So I won't cover one of those because they're all really good, but I just did them.","startTime":"01:14:17","endTime":"01:14:21","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"So another one we did, there was an interesting one at a university where they had just made a bunch of changes and we had helped them with those and it was fine.","startTime":"01:14:21","endTime":"01:14:33","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"And then so they had a high availability system where they'd have a JBOD full of hard drives connected to two different servers so that if one server goes down, they could import the pool on the other one.","startTime":"01:14:33","endTime":"01:14:46","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"And they had a bunch of these pools and they had just numbered them like everybody does.","startTime":"01:14:47","endTime":"01:14:52","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"This is not the same as the war story in the Halloween one where a similar thing kind of happened.","startTime":"01:14:52","endTime":"01:14:56","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"But after importing them, after doing the upgrade, they accidentally did import pool 4 on server 4 and then went to server 5 and accidentally typed import pool 4 instead of pool 5.","startTime":"01:14:56","endTime":"01:15:10","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"So now pool 4 was mounted on two machines at the same time, which isn't supposed to be able to happen because they didn't enable the feature that stops it because there's a trade off for it.","startTime":"01:15:11","endTime":"01:15:23","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"But so now every time there's a new transaction group, server 4 is writing to the hard drive and then server 5 is writing different information with a different transaction group number over top of that.","startTime":"01:15:23","endTime":"01:15:33","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"And so they're just sitting there writing over top of each other, somewhat being correct and somewhat not.","startTime":"01:15:34","endTime":"01:15:39","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"And also meaning that if you wrote different data on different servers, they're going to not know that the other one has used a certain bit of space.","startTime":"01:15:39","endTime":"01:15:47","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"So think it's free and allocate it and basically overwrite something Server 4 just wrote with something different that Server 5 just wrote.","startTime":"01:15:47","endTime":"01:15:53","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"And you can really corrupt things really badly.","startTime":"01:15:54","endTime":"01:15:58","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"They managed to catch it after I think it was about 25 minutes or so.","startTime":"01:15:58","endTime":"01:16:01","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"And so they shut everything down and called us and things were quite broken and we had to invent some new tools to be able to fix it, but eventually got to the point where we could do a version of ZFS sen to copy all the data to a spare machine they had so that they could get most of their data back, except for obviously the newer stuff they had overwritten and a couple of pieces got damaged.","startTime":"01:16:02","endTime":"01:16:26","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"But we managed to get most of the data back by basically being able to do ZFS send.","startTime":"01:16:26","endTime":"01:16:31","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"And the big advantage there over copying it some other way was just the speed, the fact that we could saturate their 10 gigabit network.","startTime":"01:16:32","endTime":"01:16:38","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"And when you're talking about hundreds and hundreds of terabytes of data, it's really slow to copy.","startTime":"01:16:38","endTime":"01:16:44","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"So you really need a way to try to do that quickly.","startTime":"01:16:44","endTime":"01:16:47","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"Good stuff.","startTime":"01:16:48","endTime":"01:16:49","speaker_name":"Viktor Petersson","speaker_id":0},{"sentence":"This has been very helpful and I think hopefully opened the eyes to ZFS to a new audience.","startTime":"01:16:50","endTime":"01:16:57","speaker_name":"Viktor Petersson","speaker_id":0},{"sentence":"And I think it's well worth shouting about because I think it's a fantastic file system.","startTime":"01:16:57","endTime":"01:17:03","speaker_name":"Viktor Petersson","speaker_id":0},{"sentence":"So I'm very happy to wider adoption for it.","startTime":"01:17:03","endTime":"01:17:06","speaker_name":"Viktor Petersson","speaker_id":0},{"sentence":"So thank you so much for coming on the show, Alan.","startTime":"01:17:06","endTime":"01:17:09","speaker_name":"Viktor Petersson","speaker_id":0},{"sentence":"Very much appreciated.","startTime":"01:17:10","endTime":"01:17:11","speaker_name":"Viktor Petersson","speaker_id":0},{"sentence":"Any last words about Clara?","startTime":"01:17:11","endTime":"01:17:13","speaker_name":"Viktor Petersson","speaker_id":0},{"sentence":"Something you want to say, you want.","startTime":"01:17:13","endTime":"01:17:14","speaker_name":"Viktor Petersson","speaker_id":0},{"sentence":"To draw attention to?","startTime":"01:17:14","endTime":"01:17:15","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"If you have.","startTime":"01:17:16","endTime":"01:17:17","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"If you want to learn more about zfs, I do a weekly podcast where we tend to answer quite a few people's questions.","startTime":"01:17:17","endTime":"01:17:23","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"They write in about ZFS.","startTime":"01:17:23","endTime":"01:17:24","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"So that's 2.5 admins.com so 2 and a half admins.","startTime":"01:17:24","endTime":"01:17:28","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"It's a podcast with myself and another ZFS admin, Jim Salter, and a host who's trying to become a sysadmin.","startTime":"01:17:28","endTime":"01:17:34","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"So we have two and a half admins.","startTime":"01:17:34","endTime":"01:17:36","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"So if you're into sysadminning in general, or ZFS specifically, you want to check out that podcast that comes out every Thursday.","startTime":"01:17:36","endTime":"01:17:43","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"And there's also we have a website, practicalzfs.com where we have a discourse set up replacing the old Reddit rzfs.","startTime":"01:17:44","endTime":"01:17:52","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"And so it's a place where people ask a lot of ZFS questions, we answer them and kind of collect a whole thing there.","startTime":"01:17:53","endTime":"01:17:58","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"But yeah, if you need support with ZFS or feature development or same for freebsd, then do hit us up at clarasystems.","startTime":"01:17:58","endTime":"01:18:06","speaker_name":"Allan Jude","speaker_id":1},{"sentence":"Com.","startTime":"01:18:07","endTime":"01:18:07","speaker_name":"Viktor Petersson","speaker_id":0},{"sentence":"Amazing.","startTime":"01:18:07","endTime":"01:18:08","speaker_name":"Viktor Petersson","speaker_id":0},{"sentence":"Again, thanks so much for coming on the show, Alan.","startTime":"01:18:08","endTime":"01:18:10","speaker_name":"Viktor Petersson","speaker_id":0},{"sentence":"Have a good one.","startTime":"01:18:10","endTime":"01:18:11","speaker_name":"Viktor Petersson","speaker_id":0},{"sentence":"Talk soon.","startTime":"01:18:11","endTime":"01:18:11","speaker_name":"Viktor Petersson","speaker_id":0},{"sentence":"Cheers.","startTime":"01:18:11","endTime":"01:18:12","speaker_name":"Viktor Petersson","speaker_id":0},{"sentence":"Bye.","startTime":"01:18:12","endTime":"01:18:12","speaker_name":"Allan Jude","speaker_id":1}]