<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="robots" content="index, follow">
  <meta http-equiv="content-language" content="en">

  <!-- Resource Hints -->
  <link rel="dns-prefetch" href="https://fonts.googleapis.com">
  <link rel="dns-prefetch" href="https://fonts.gstatic.com">

  <!-- Preload Critical Resources -->
  <link rel="preload" href="/assets/css/styles.css" as="style">
  <link rel="preload" href="/assets/css/main.css" as="style">

  <title>How I Use Home Assistant in 2025</title>
  <meta name="description" content="Insights on DevSecOps, cloud architecture, and building secure, scalable systems. Sharing practical experience from running tech companies and implementing software supply chain security at scale.">

  <!-- Open Graph / Facebook -->
  <meta property="og:type" content="article">
  <meta property="og:url" content="https://vpetersson.com/2025/01/22/how-i-use-home-assistant-in-2025.html">
  <meta property="og:title" content="How I Use Home Assistant in 2025">
  <meta property="og:description" content="Insights on DevSecOps, cloud architecture, and building secure, scalable systems. Sharing practical experience from running tech companies and implementing software supply chain security at scale.">
  <meta property="og:image" content="https://vpetersson.com/assets/images/site/talk.webp">

  <!-- LinkedIn -->
  <meta property="og:site_name" content="Viktor's Tech Musings & Security Paranoia">
  <meta property="article:author" content="https://www.linkedin.com/in/vpetersson/">
  
  <meta property="article:published_time" content="2025-01-22T00:00:00+00:00">
  

  <!-- X (formerly Twitter) -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@vpetersson">
  <meta name="twitter:creator" content="@vpetersson">
  <meta name="twitter:title" content="How I Use Home Assistant in 2025">
  <meta name="twitter:description" content="Insights on DevSecOps, cloud architecture, and building secure, scalable systems. Sharing practical experience from running tech companies and implementing software supply chain security at scale.">
  <meta name="twitter:image" content="https://vpetersson.com/assets/images/site/talk.webp">

  <!-- Social Profile Links -->
  <link rel="me" href="https://github.com/vpetersson">
  <link rel="me" href="https://www.linkedin.com/in/vpetersson/">
  <link rel="me" href="https://hachyderm.io/@vpetersson@hachyderm.io">

  <!-- Schema.org Person -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "Person",
    "name": "Viktor Petersson",
    "url": "https://vpetersson.com",
    "image": "https://vpetersson.com/assets/images/site/talk.webp",
    "sameAs": [
      "https://github.com/vpetersson",
      "https://www.linkedin.com/in/vpetersson/",
      "https://hachyderm.io/@vpetersson@hachyderm.io",
      "https://twitter.com/vpetersson"
    ]
  }
  </script>

  <!-- Custom meta tags -->
  

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css?family=Anton|DM Sans|Roboto|Hanken+Grotesk"
    />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600&family=Fira+Code:wght@400;500;600&display=swap" rel="stylesheet">

  <!-- Styles -->
  <link rel="stylesheet" href="/assets/css/styles.css">
  <link rel="stylesheet" href="/assets/css/main.css">
  <link rel="stylesheet" href="/assets/css/native.css">
  
  <!-- Font Awesome (bundled from node_modules) -->
  <link rel="stylesheet" href="/assets/css/fontawesome-core.css">
  <link rel="stylesheet" href="/assets/css/fontawesome-solid.css">
  <link rel="stylesheet" href="/assets/css/fontawesome-brands.css">

  <!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-ZY6ZNLNNC8"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-ZY6ZNLNNC8');

  // Track outbound links and CTAs
  function trackEvent(category, action, label, source) {
    gtag('event', action, {
      'event_category': category,
      'event_label': label,
      'source': source
    });
  }
</script>


  <link rel="canonical" href="https://vpetersson.com/2025/01/22/how-i-use-home-assistant-in-2025.html" />
</head>

  <body>
    <!-- Skip Navigation -->
<a href="#main-content" class="skip-navigation">Skip to main content</a>

<header class="p-8 flex justify-between bg-primaryBG border-b border-white-alpha-20" role="banner">
  <div class="flex gap-10 justify-between items-center">
    <a href="/" aria-label="Viktor Petersson - Home">
      <img src="/assets/images/site/logo-white.svg" alt="Viktor Petersson logo" width="120" height="40" />
    </a>
    <nav class="hidden lg:flex gap-6">
  
    <a href="/" class="text-white uppercase">HOME</a>
  
    <a href="/about" class="text-white uppercase">ABOUT</a>
  
    <a href="/consulting" class="text-white uppercase">CONSULTING</a>
  
    <a href="/podcast" class="text-white uppercase">PODCAST</a>
  
    <a href="/blog" class="text-white uppercase">BLOG</a>
  
    <a href="https://studio.viktopia.io/" class="text-white uppercase">VIKTOPIA STUDIO</a>
  
</nav>

  </div>
  <div class="flex gap-2 justify-between items-center">
    <div class="header-search hidden lg:block">
      <form action="/search" method="get" role="search">
        <label for="searchright" class="sr-only">Search the site</label>
        <input
          class="search expandright"
          id="searchright"
          type="search"
          name="query"
          placeholder="Search"
          aria-label="Search"
        >
        <button class="button searchbutton" type="submit" aria-label="Submit search">
          <span class="mglass" aria-hidden="true">&#9906;</span>
        </button>
      </form>
    </div>

    <div class="hidden lg:block">
      <div class="flex gap-[13px] ">
  <a href="https://twitter.com/vpetersson" target="_new">
    <img src="/assets/images/site/x-white.svg" alt="x logo" />
  </a>
  <a href="https://github.com/vpetersson" target="_new">
    <img src="/assets/images/site/github-white.svg" alt="github logo" />
  </a>
  <a href="https://www.linkedin.com/in/vpetersson/" target="_new">
    <img src="/assets/images/site/linkedin-white.svg" alt="linkedIn logo" />
  </a>
</div>
    </div>

    <!-- Use modern mobile navigation -->
    <!-- Modern Mobile Navigation -->
<div class="mobile-nav-container lg:hidden">
  <!-- Menu Toggle Button -->
  <button
    class="mobile-menu-toggle btn-reset touch-target"
    aria-label="Toggle navigation menu"
    aria-expanded="false"
    aria-controls="mobile-menu"
    data-menu-toggle
  >
    <span class="hamburger-icon" aria-hidden="true">
      <span class="hamburger-line"></span>
      <span class="hamburger-line"></span>
      <span class="hamburger-line"></span>
    </span>
  </button>

  <!-- Mobile Menu Backdrop -->
  <div
    class="mobile-menu-backdrop"
    data-menu-backdrop
    aria-hidden="true"
  ></div>

  <!-- Mobile Menu Panel -->
  <nav
    class="mobile-menu"
    id="mobile-menu"
    aria-labelledby="mobile-menu-label"
    data-menu-panel
  >
    <!-- Menu Header -->
    <div class="mobile-menu-header">
      <h2 id="mobile-menu-label" class="sr-only">Navigation Menu</h2>
      <button
        class="mobile-menu-close btn-reset touch-target"
        aria-label="Close navigation menu"
        data-menu-close
      >
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M18 6L6 18M6 6l12 12"/>
        </svg>
      </button>
    </div>

    <!-- Navigation Links -->
    <ul class="mobile-menu-list" role="list">
      
        <li class="mobile-menu-item">
          <a
            href="/"
            class="mobile-menu-link keyboard-focusable"
            
          >
            HOME
          </a>
        </li>
      
        <li class="mobile-menu-item">
          <a
            href="/about"
            class="mobile-menu-link keyboard-focusable"
            
          >
            ABOUT
          </a>
        </li>
      
        <li class="mobile-menu-item">
          <a
            href="/consulting"
            class="mobile-menu-link keyboard-focusable"
            
          >
            CONSULTING
          </a>
        </li>
      
        <li class="mobile-menu-item">
          <a
            href="/podcast"
            class="mobile-menu-link keyboard-focusable"
            
          >
            PODCAST
          </a>
        </li>
      
        <li class="mobile-menu-item">
          <a
            href="/blog"
            class="mobile-menu-link keyboard-focusable"
            
          >
            BLOG
          </a>
        </li>
      
        <li class="mobile-menu-item">
          <a
            href="https://studio.viktopia.io/"
            class="mobile-menu-link keyboard-focusable"
            
          >
            VIKTOPIA STUDIO
          </a>
        </li>
      
    </ul>

    <!-- Social Links -->
    <div class="mobile-menu-footer">
      <div class="mobile-social-links">
        <div class="flex gap-[13px] ">
  <a href="https://twitter.com/vpetersson" target="_new">
    <img src="/assets/images/site/x-white.svg" alt="x logo" />
  </a>
  <a href="https://github.com/vpetersson" target="_new">
    <img src="/assets/images/site/github-white.svg" alt="github logo" />
  </a>
  <a href="https://www.linkedin.com/in/vpetersson/" target="_new">
    <img src="/assets/images/site/linkedin-white.svg" alt="linkedIn logo" />
  </a>
</div>
      </div>
    </div>
  </nav>
</div>

<style>
/* Mobile Navigation Styles */
.mobile-nav-container {
  position: relative;
}

.mobile-menu-toggle {
  position: relative;
  z-index: var(--z-fixed);
  color: var(--color-white);
  transition: transform var(--transition-normal);

  &[aria-expanded="true"] {
    transform: rotate(90deg);
  }
}

.hamburger-icon {
  display: flex;
  flex-direction: column;
  width: 24px;
  height: 18px;
  justify-content: space-between;
}

.hamburger-line {
  width: 100%;
  height: 2px;
  background: currentColor;
  border-radius: 1px;
  transition: all var(--transition-normal);
  transform-origin: center;
}

.mobile-menu-toggle[aria-expanded="true"] .hamburger-line {
  &:nth-child(1) {
    transform: rotate(45deg) translate(6px, 6px);
  }

  &:nth-child(2) {
    opacity: 0;
  }

  &:nth-child(3) {
    transform: rotate(-45deg) translate(6px, -6px);
  }
}

.mobile-menu-backdrop {
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.5);
  backdrop-filter: blur(4px);
  opacity: 0;
  visibility: hidden;
  transition: all var(--transition-normal);
  z-index: var(--z-modal);
}

.mobile-menu-backdrop.is-visible {
  opacity: 1;
  visibility: visible;
}

.mobile-menu {
  position: fixed;
  top: 0;
  right: 0;
  width: min(400px, 100vw);
  height: 100vh;
  background: var(--color-gray-900);
  border-left: 1px solid var(--color-gray-200);
  transform: translateX(100%);
  transition: transform var(--transition-normal);
  z-index: var(--z-modal);
  display: flex;
  flex-direction: column;
  overflow-y: auto;
  overscroll-behavior: contain;
}

.mobile-menu.is-open {
  transform: translateX(0);
}

.mobile-menu-header {
  display: flex;
  justify-content: flex-end;
  align-items: center;
  padding: var(--space-4);
  border-bottom: 1px solid var(--color-gray-200);
}

.mobile-menu-close {
  color: var(--color-white);
}

.mobile-menu-list {
  flex: 1;
  padding: var(--space-4) 0;
  margin: 0;
  list-style: none;
}

.mobile-menu-item {
  margin: 0;
}

.mobile-menu-link {
  display: block;
  padding: var(--space-3) var(--space-4);
  color: var(--color-white);
  text-decoration: none;
  font-family: var(--font-family-body);
  font-size: var(--font-size-lg);
  font-weight: 500;
  text-transform: uppercase;
  letter-spacing: 0.05em;
  transition: all var(--transition-normal);
  border-left: 3px solid transparent;

  &:hover {
    background: var(--color-gray-800);
    border-left-color: var(--color-primary);
  }

  &[aria-current="page"] {
    color: var(--color-primary);
    border-left-color: var(--color-primary);
    background: var(--color-gray-800);
  }
}

.mobile-menu-footer {
  padding: var(--space-4);
  border-top: 1px solid var(--color-gray-200);
}

.mobile-social-links {
  display: flex;
  gap: var(--space-3);
  justify-content: center;
}

/* Simple instant display */
.mobile-menu-item {
  opacity: 1;
}
</style>

<script>
// Modern Mobile Navigation JavaScript
(function() {
  const menuToggle = document.querySelector('[data-menu-toggle]');
  const menuPanel = document.querySelector('[data-menu-panel]');
  const menuBackdrop = document.querySelector('[data-menu-backdrop]');
  const menuClose = document.querySelector('[data-menu-close]');
  const menuLinks = document.querySelectorAll('.mobile-menu-link');

  let isOpen = false;

  function openMenu() {
    isOpen = true;
    menuToggle.setAttribute('aria-expanded', 'true');
    menuPanel.classList.add('is-open');
    menuBackdrop.classList.add('is-visible');
    document.body.style.overflow = 'hidden';

    // Focus first menu item
    const firstLink = menuPanel.querySelector('.mobile-menu-link');
    if (firstLink) {
      firstLink.focus();
    }
  }

  function closeMenu() {
    isOpen = false;
    menuToggle.setAttribute('aria-expanded', 'false');
    menuPanel.classList.remove('is-open');
    menuBackdrop.classList.remove('is-visible');
    document.body.style.overflow = '';

    // Return focus to toggle button
    menuToggle.focus();
  }

  function toggleMenu() {
    isOpen ? closeMenu() : openMenu();
  }

  // Event listeners
  menuToggle.addEventListener('click', toggleMenu);
  menuClose.addEventListener('click', closeMenu);
  menuBackdrop.addEventListener('click', closeMenu);

  // Close on link click
  menuLinks.forEach(link => {
    link.addEventListener('click', closeMenu);
  });

  // Keyboard navigation
  document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape' && isOpen) {
      closeMenu();
    }
  });

  // Trap focus in menu when open
  menuPanel.addEventListener('keydown', (e) => {
    if (e.key === 'Tab') {
      const focusableElements = menuPanel.querySelectorAll(
        'button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])'
      );
      const firstElement = focusableElements[0];
      const lastElement = focusableElements[focusableElements.length - 1];

      if (e.shiftKey && document.activeElement === firstElement) {
        e.preventDefault();
        lastElement.focus();
      } else if (!e.shiftKey && document.activeElement === lastElement) {
        e.preventDefault();
        firstElement.focus();
      }
    }
  });
})();
</script>
  </div>
</header>

    <main id="main-content" class="body">
      <!-- Blog post schema -->
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://vpetersson.com/2025/01/22/how-i-use-home-assistant-in-2025.html"
  },
  "headline": "How I Use Home Assistant in 2025",
  "description": null,
  "datePublished": "2025-01-22T00:00:00+00:00",
  "dateModified": "2025-01-22T00:00:00+00:00",
  "author": {
    "@type": "Person",
    "@id": "https://vpetersson.com/about/#person",
    "name": "Viktor Petersson",
    "url": "https://vpetersson.com/about/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Viktor Petersson",
    "url": "https://vpetersson.com",
    "logo": {
      "@type": "ImageObject",
      "url": "https://vpetersson.com/assets/images/site/talk.webp"
    }
  },
  
  "inLanguage": "en",
  "wordCount": "3200",
  "keywords": ["home-assistant","home-automation","smart-home","iot"]
}
</script>

<!-- Breadcrumbs schema -->
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position": 1,
      "name": "Home",
      "item": "https://vpetersson.com"
    },
    {
      "@type": "ListItem",
      "position": 2,
      "name": "Blog",
      "item": "https://vpetersson.com/blog/"
    },
    {
      "@type": "ListItem",
      "position": 3,
      "name": "How I Use Home Assistant in 2025",
      "item": "https://vpetersson.com/2025/01/22/how-i-use-home-assistant-in-2025.html"
    }
  ]
}
</script>
<div class="page-header page-header-blog">
  <h2 class="uppercase text-[48px] md:text-[91px] lg:text-[140px] xl:text-[186px] text-white text-center">Blog</h2>
</div>
<div class="bg-secondaryBG blog-post">
  <div class="md:max-w-[665px] mx-4 sm:mx-6 md:mx-auto py-8 md:py-10 lg:py-20">
    <h2 class="mb-6">How I Use Home Assistant in 2025</h2>
    <div class="flex mb-6 gap-6 text-xs">
      <span class="uppercase">
        22 JAN • 2025
      </span>
      <span class="blog-time">
        18 minutes
      </span>
    </div>
    <article class="leading-[26px]">
      <p>I’ve been using Home Assistant for about seven years now, starting back when I was living in a small apartment. At the time, my setup was modest: I used the <strong>IKEA Smart Hub</strong> (when it first launched) to tie together all my apartment’s lights. As I got more comfortable with automations, I also began building <a href="/2019/11/16/home-assistant-and-esphome.html">custom hardware like temperature and humidity sensors</a>.</p>

<p>However, once I started adding more complexity (more devices, more automations), I realized that running Home Assistant on a Raspberry Pi just wasn’t viable anymore. This was before Home Assistant offered their own hardware (which I haven’t tried, so I can’t say much about it). But for me, the main issue was the database. By default, Home Assistant uses SQLite, and when you have a ton of sensor data flowing in, SQLite can start choking.</p>

<p>My solution was to move everything to a VM on my home server. I also migrated Home Assistant’s main database to MySQL, and for longer-term metrics and historical data, I set up an InfluxDB server. (I’ve documented the details of my <a href="/2024/05/04/home-server-journey.html">home server build in another blog post</a>.)</p>

<h2 id="scaling-up-in-a-new-house">Scaling Up in a New House</h2>

<p>When I moved into a house, my Home Assistant installation grew significantly: more rooms, more lights, and more devices overall. Right now, I have over 100 devices connected to Home Assistant, including a large number of smart lights (all IKEA), plus an assortment of other smart devices. Practically every bulb in my home is now integrated into Home Assistant.</p>

<h3 id="adaptive-lighting-moving-beyond-flux">Adaptive Lighting: Moving Beyond Flux</h3>

<p>One of the crucial features for me is <strong>Adaptive Lighting</strong>. Initially, I used Flux (an older solution for synchronizing lights with the time of day - see <a href="/2020/05/25/homeassistant-ikea-tradfri-flux-sensors.html">my guide on Home Assistant, Flux and sensors</a>), but I’ve since migrated to the new Adaptive Lighting integration available through HACS (Home Assistant Community Store). This newer system is much more sophisticated, offering better control over color temperature and brightness throughout the day.</p>

<p>Managing this setup comes with two main challenges. First, neither Flux nor Adaptive Lighting can target light groups. Instead, you need to explicitly list every single light entity in your configuration. This becomes particularly tedious when you have dozens of lights that you want to manage together. It would have been much more convenient to just point the integration to a group and have it handle all the lights within that group automatically.</p>

<p>The second challenge is that even though all my bulbs are from IKEA, they don’t have all the same features. This means I need separate configurations for each category to get Adaptive Lighting working correctly. But the effort is worth it: circadian rhythms are important to me, and I really want that smooth, automatic shift in color temperature from warm yellows in the morning and evenings to cooler whites and blues during midday.</p>

<h2 id="using-cursor-to-speed-up-configuration">Using Cursor to Speed Up Configuration</h2>

<p>One big leap for me this year has been leveraging <a href="https://www.cursor.com">Cursor</a>, an AI coding assistant, to handle the more tedious parts of Home Assistant’s YAML configurations. I’ll admit, I’ve never had the time to master every detail of Home Assistant’s DSL or its configuration files.</p>

<h3 id="writing-a-custom-parser">Writing a Custom Parser</h3>

<p>The first major task I tackled with Cursor was writing a custom script to parse all my lights, figure out exactly what kind of bulb each one is, and spit out debugging information. This is the foundation of building the correct adaptive lighting setup. Once the script categorizes the bulbs, I can then create or update the YAML configuration for each bulb type.</p>

<p>Here’s the script I use to analyze my Home Assistant lights. It connects to the Home Assistant API, categorizes all lights by their capabilities, and provides detailed debugging information about their current state and supported features:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">requests</span>
<span class="kn">import</span> <span class="n">json</span>
<span class="kn">import</span> <span class="n">os</span>
<span class="kn">from</span> <span class="n">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>

<span class="n">TOKEN</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="nf">getenv</span><span class="p">(</span><span class="sh">"</span><span class="s">HA_TOKEN</span><span class="sh">"</span><span class="p">)</span>  <span class="c1"># Set this to your long-lived access token (Bearer: &lt;token&gt;)
</span>
<span class="c1"># Function to get entity state
</span><span class="k">def</span> <span class="nf">get_entity_state</span><span class="p">(</span><span class="n">entity_id</span><span class="p">):</span>
    <span class="n">url</span> <span class="o">=</span> <span class="sh">"</span><span class="s">http://localhost:8123/api/states/</span><span class="sh">"</span> <span class="o">+</span> <span class="n">entity_id</span>
    <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
        <span class="sh">"</span><span class="s">Authorization</span><span class="sh">"</span><span class="p">:</span> <span class="n">TOKEN</span><span class="p">,</span>
        <span class="sh">"</span><span class="s">content-type</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">application/json</span><span class="sh">"</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">response</span><span class="p">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">response</span><span class="p">.</span><span class="nf">json</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Error getting state for </span><span class="si">{</span><span class="n">entity_id</span><span class="si">}</span><span class="s">: </span><span class="si">{</span><span class="n">response</span><span class="p">.</span><span class="n">status_code</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">None</span>

<span class="k">def</span> <span class="nf">get_all_lights</span><span class="p">():</span>
    <span class="sh">"""</span><span class="s">Get all light entities from Home Assistant.</span><span class="sh">"""</span>
    <span class="n">url</span> <span class="o">=</span> <span class="sh">"</span><span class="s">http://localhost:8123/api/states</span><span class="sh">"</span>
    <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
        <span class="sh">"</span><span class="s">Authorization</span><span class="sh">"</span><span class="p">:</span> <span class="n">TOKEN</span><span class="p">,</span>
        <span class="sh">"</span><span class="s">content-type</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">application/json</span><span class="sh">"</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">response</span><span class="p">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
        <span class="n">entities</span> <span class="o">=</span> <span class="n">response</span><span class="p">.</span><span class="nf">json</span><span class="p">()</span>
        <span class="n">lights</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">entity</span> <span class="ow">in</span> <span class="n">entities</span><span class="p">:</span>
            <span class="n">entity_id</span> <span class="o">=</span> <span class="n">entity</span><span class="p">[</span><span class="sh">'</span><span class="s">entity_id</span><span class="sh">'</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">entity_id</span><span class="p">.</span><span class="nf">startswith</span><span class="p">(</span><span class="sh">'</span><span class="s">light.</span><span class="sh">'</span><span class="p">):</span>
                <span class="n">lights</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">entity_id</span><span class="p">)</span>
        <span class="k">return</span> <span class="nf">sorted</span><span class="p">(</span><span class="n">lights</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Error getting entities: </span><span class="si">{</span><span class="n">response</span><span class="p">.</span><span class="n">status_code</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[]</span>

<span class="k">def</span> <span class="nf">get_adaptive_switch_state</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
    <span class="n">switch_id</span> <span class="o">=</span> <span class="sa">f</span><span class="sh">"</span><span class="s">switch.adaptive_lighting_</span><span class="si">{</span><span class="n">name</span><span class="p">.</span><span class="nf">lower</span><span class="p">()</span><span class="si">}</span><span class="sh">"</span>
    <span class="n">state</span> <span class="o">=</span> <span class="nf">get_entity_state</span><span class="p">(</span><span class="n">switch_id</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">state</span><span class="p">:</span>
        <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Adaptive switch </span><span class="si">{</span><span class="n">switch_id</span><span class="si">}</span><span class="s"> full state: </span><span class="si">{</span><span class="n">json</span><span class="p">.</span><span class="nf">dumps</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">state</span>

<span class="k">def</span> <span class="nf">check_light_capabilities</span><span class="p">(</span><span class="n">light_attrs</span><span class="p">,</span> <span class="n">group_name</span><span class="p">,</span> <span class="n">light_id</span><span class="p">,</span> <span class="n">adaptive_config</span><span class="p">):</span>
    <span class="sh">"""</span><span class="s">Check if light capabilities match adaptive lighting settings.</span><span class="sh">"""</span>
    <span class="n">warnings</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># Check color temperature support
</span>    <span class="nf">if </span><span class="p">(</span><span class="sh">'</span><span class="s">color_temp_kelvin</span><span class="sh">'</span> <span class="ow">in</span> <span class="n">adaptive_config</span> <span class="ow">and</span>
        <span class="sh">'</span><span class="s">supported_color_modes</span><span class="sh">'</span> <span class="ow">in</span> <span class="n">light_attrs</span> <span class="ow">and</span>
        <span class="sh">'</span><span class="s">color_temp</span><span class="sh">'</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">light_attrs</span><span class="p">[</span><span class="sh">'</span><span class="s">supported_color_modes</span><span class="sh">'</span><span class="p">]):</span>
        <span class="n">warnings</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">WARNING: </span><span class="si">{</span><span class="n">light_id</span><span class="si">}</span><span class="s"> in </span><span class="si">{</span><span class="n">group_name</span><span class="si">}</span><span class="s"> group doesn</span><span class="sh">'</span><span class="s">t support color temperature, </span><span class="sh">"</span>
                      <span class="sa">f</span><span class="sh">"</span><span class="s">but adaptive lighting is trying to set it. Supported modes: </span><span class="si">{</span><span class="n">light_attrs</span><span class="p">[</span><span class="sh">'</span><span class="s">supported_color_modes</span><span class="sh">'</span><span class="p">]</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>

    <span class="c1"># Check brightness support
</span>    <span class="nf">if </span><span class="p">(</span><span class="sh">'</span><span class="s">brightness_pct</span><span class="sh">'</span> <span class="ow">in</span> <span class="n">adaptive_config</span> <span class="ow">and</span>
        <span class="sh">'</span><span class="s">supported_color_modes</span><span class="sh">'</span> <span class="ow">in</span> <span class="n">light_attrs</span> <span class="ow">and</span>
        <span class="sh">'</span><span class="s">brightness</span><span class="sh">'</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">light_attrs</span><span class="p">[</span><span class="sh">'</span><span class="s">supported_color_modes</span><span class="sh">'</span><span class="p">]):</span>
        <span class="n">warnings</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">WARNING: </span><span class="si">{</span><span class="n">light_id</span><span class="si">}</span><span class="s"> in </span><span class="si">{</span><span class="n">group_name</span><span class="si">}</span><span class="s"> group doesn</span><span class="sh">'</span><span class="s">t support brightness, </span><span class="sh">"</span>
                      <span class="sa">f</span><span class="sh">"</span><span class="s">but adaptive lighting is trying to set it. Supported modes: </span><span class="si">{</span><span class="n">light_attrs</span><span class="p">[</span><span class="sh">'</span><span class="s">supported_color_modes</span><span class="sh">'</span><span class="p">]</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">warnings</span>

<span class="k">def</span> <span class="nf">analyze_current_state</span><span class="p">(</span><span class="n">lights</span><span class="p">,</span> <span class="n">group_name</span><span class="p">):</span>
    <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="se">\n</span><span class="s">=== </span><span class="si">{</span><span class="n">group_name</span><span class="si">}</span><span class="s"> Current State ===</span><span class="sh">"</span><span class="p">)</span>
    <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Analyzing at: </span><span class="si">{</span><span class="n">datetime</span><span class="p">.</span><span class="nf">now</span><span class="p">().</span><span class="n">strftime</span><span class="p">(</span><span class="sh">'</span><span class="s">%Y-%m-%d %H</span><span class="si">:</span><span class="o">%</span><span class="n">M</span><span class="si">:</span><span class="o">%</span><span class="n">S</span><span class="sh">'</span><span class="s">)</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>

    <span class="c1"># Get adaptive lighting switch state
</span>    <span class="n">switch_state</span> <span class="o">=</span> <span class="nf">get_adaptive_switch_state</span><span class="p">(</span><span class="n">group_name</span><span class="p">)</span>
    <span class="n">adaptive_config</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">if</span> <span class="n">switch_state</span><span class="p">:</span>
        <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Adaptive Lighting Switch: </span><span class="si">{</span><span class="n">switch_state</span><span class="p">[</span><span class="sh">'</span><span class="s">state</span><span class="sh">'</span><span class="p">]</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
        <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Last changed: </span><span class="si">{</span><span class="n">switch_state</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">last_changed</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">unknown</span><span class="sh">'</span><span class="p">)</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
        <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Attributes: </span><span class="si">{</span><span class="n">json</span><span class="p">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">switch_state</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="sh">'</span><span class="s">attributes</span><span class="sh">'</span><span class="p">,</span> <span class="si">{}</span><span class="p">),</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
        <span class="n">adaptive_config</span> <span class="o">=</span> <span class="n">switch_state</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">attributes</span><span class="sh">'</span><span class="p">,</span> <span class="p">{})</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">Adaptive Lighting Switch: Not found</span><span class="sh">"</span><span class="p">)</span>

    <span class="n">now</span> <span class="o">=</span> <span class="n">datetime</span><span class="p">.</span><span class="nf">now</span><span class="p">()</span>
    <span class="n">current_time</span> <span class="o">=</span> <span class="n">now</span><span class="p">.</span><span class="nf">strftime</span><span class="p">(</span><span class="sh">"</span><span class="s">%H:%M:%S</span><span class="sh">"</span><span class="p">)</span>
    <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Current Time: </span><span class="si">{</span><span class="n">current_time</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>

    <span class="c1"># Track brightness statistics
</span>    <span class="n">brightness_stats</span> <span class="o">=</span> <span class="p">{</span>
        <span class="sh">'</span><span class="s">min</span><span class="sh">'</span><span class="p">:</span> <span class="nf">float</span><span class="p">(</span><span class="sh">'</span><span class="s">inf</span><span class="sh">'</span><span class="p">),</span>
        <span class="sh">'</span><span class="s">max</span><span class="sh">'</span><span class="p">:</span> <span class="nf">float</span><span class="p">(</span><span class="sh">'</span><span class="s">-inf</span><span class="sh">'</span><span class="p">),</span>
        <span class="sh">'</span><span class="s">total</span><span class="sh">'</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="sh">'</span><span class="s">count</span><span class="sh">'</span><span class="p">:</span> <span class="mi">0</span>
    <span class="p">}</span>

    <span class="c1"># Group lights by capabilities
</span>    <span class="n">light_types</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">capability_warnings</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">light</span> <span class="ow">in</span> <span class="n">lights</span><span class="p">:</span>
        <span class="n">state</span> <span class="o">=</span> <span class="nf">get_entity_state</span><span class="p">(</span><span class="n">light</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">state</span><span class="p">:</span>
            <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="si">{</span><span class="n">light</span><span class="si">}</span><span class="s">: Not found or offline</span><span class="sh">"</span><span class="p">)</span>
            <span class="k">continue</span>

        <span class="n">attrs</span> <span class="o">=</span> <span class="n">state</span><span class="p">[</span><span class="sh">'</span><span class="s">attributes</span><span class="sh">'</span><span class="p">]</span>
        <span class="n">status</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">capabilities</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># Check capabilities against adaptive lighting settings
</span>        <span class="k">if</span> <span class="n">adaptive_config</span><span class="p">:</span>
            <span class="n">warnings</span> <span class="o">=</span> <span class="nf">check_light_capabilities</span><span class="p">(</span><span class="n">attrs</span><span class="p">,</span> <span class="n">group_name</span><span class="p">,</span> <span class="n">light</span><span class="p">,</span> <span class="n">adaptive_config</span><span class="p">)</span>
            <span class="n">capability_warnings</span><span class="p">.</span><span class="nf">extend</span><span class="p">(</span><span class="n">warnings</span><span class="p">)</span>

        <span class="c1"># Basic state
</span>        <span class="k">if</span> <span class="n">state</span><span class="p">[</span><span class="sh">'</span><span class="s">state</span><span class="sh">'</span><span class="p">]</span> <span class="o">==</span> <span class="sh">'</span><span class="s">on</span><span class="sh">'</span><span class="p">:</span>
            <span class="k">if</span> <span class="sh">'</span><span class="s">brightness</span><span class="sh">'</span> <span class="ow">in</span> <span class="n">attrs</span><span class="p">:</span>
                <span class="n">brightness_pct</span> <span class="o">=</span> <span class="nf">round</span><span class="p">((</span><span class="n">attrs</span><span class="p">[</span><span class="sh">'</span><span class="s">brightness</span><span class="sh">'</span><span class="p">]</span> <span class="o">/</span> <span class="mi">255</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span>
                <span class="n">status</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">brightness: </span><span class="si">{</span><span class="n">brightness_pct</span><span class="si">}</span><span class="s">%</span><span class="sh">"</span><span class="p">)</span>
                <span class="c1"># Update brightness statistics
</span>                <span class="n">brightness_stats</span><span class="p">[</span><span class="sh">'</span><span class="s">min</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="nf">min</span><span class="p">(</span><span class="n">brightness_stats</span><span class="p">[</span><span class="sh">'</span><span class="s">min</span><span class="sh">'</span><span class="p">],</span> <span class="n">brightness_pct</span><span class="p">)</span>
                <span class="n">brightness_stats</span><span class="p">[</span><span class="sh">'</span><span class="s">max</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="nf">max</span><span class="p">(</span><span class="n">brightness_stats</span><span class="p">[</span><span class="sh">'</span><span class="s">max</span><span class="sh">'</span><span class="p">],</span> <span class="n">brightness_pct</span><span class="p">)</span>
                <span class="n">brightness_stats</span><span class="p">[</span><span class="sh">'</span><span class="s">total</span><span class="sh">'</span><span class="p">]</span> <span class="o">+=</span> <span class="n">brightness_pct</span>
                <span class="n">brightness_stats</span><span class="p">[</span><span class="sh">'</span><span class="s">count</span><span class="sh">'</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="k">if</span> <span class="sh">'</span><span class="s">color_temp_kelvin</span><span class="sh">'</span> <span class="ow">in</span> <span class="n">attrs</span><span class="p">:</span>
                <span class="n">status</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">temp: </span><span class="si">{</span><span class="n">attrs</span><span class="p">[</span><span class="sh">'</span><span class="s">color_temp_kelvin</span><span class="sh">'</span><span class="p">]</span><span class="si">}</span><span class="s">K</span><span class="sh">"</span><span class="p">)</span>
            <span class="k">elif</span> <span class="sh">'</span><span class="s">color_temp</span><span class="sh">'</span> <span class="ow">in</span> <span class="n">attrs</span><span class="p">:</span>
                <span class="n">status</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">mired: </span><span class="si">{</span><span class="n">attrs</span><span class="p">[</span><span class="sh">'</span><span class="s">color_temp</span><span class="sh">'</span><span class="p">]</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>

            <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="si">{</span><span class="n">light</span><span class="si">}</span><span class="s">: ON - </span><span class="si">{</span><span class="sh">'</span><span class="s">, </span><span class="sh">'</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="n">status</span><span class="p">)</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="si">{</span><span class="n">light</span><span class="si">}</span><span class="s">: OFF</span><span class="sh">"</span><span class="p">)</span>

        <span class="c1"># Detailed capabilities
</span>        <span class="k">if</span> <span class="sh">'</span><span class="s">supported_color_modes</span><span class="sh">'</span> <span class="ow">in</span> <span class="n">attrs</span><span class="p">:</span>
            <span class="n">capabilities</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">modes:</span><span class="si">{</span><span class="n">attrs</span><span class="p">[</span><span class="sh">'</span><span class="s">supported_color_modes</span><span class="sh">'</span><span class="p">]</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
        <span class="k">if</span> <span class="sh">'</span><span class="s">min_color_temp_kelvin</span><span class="sh">'</span> <span class="ow">in</span> <span class="n">attrs</span> <span class="ow">and</span> <span class="sh">'</span><span class="s">max_color_temp_kelvin</span><span class="sh">'</span> <span class="ow">in</span> <span class="n">attrs</span><span class="p">:</span>
            <span class="n">capabilities</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">temp:</span><span class="si">{</span><span class="n">attrs</span><span class="p">[</span><span class="sh">'</span><span class="s">min_color_temp_kelvin</span><span class="sh">'</span><span class="p">]</span><span class="si">}</span><span class="s">-</span><span class="si">{</span><span class="n">attrs</span><span class="p">[</span><span class="sh">'</span><span class="s">max_color_temp_kelvin</span><span class="sh">'</span><span class="p">]</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
        <span class="k">if</span> <span class="sh">'</span><span class="s">supported_features</span><span class="sh">'</span> <span class="ow">in</span> <span class="n">attrs</span><span class="p">:</span>
            <span class="n">capabilities</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">features:</span><span class="si">{</span><span class="n">attrs</span><span class="p">[</span><span class="sh">'</span><span class="s">supported_features</span><span class="sh">'</span><span class="p">]</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>

        <span class="c1"># Group by capabilities
</span>        <span class="n">cap_key</span> <span class="o">=</span> <span class="sh">'</span><span class="s">,</span><span class="sh">'</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="nf">sorted</span><span class="p">(</span><span class="n">capabilities</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">cap_key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">light_types</span><span class="p">:</span>
            <span class="n">light_types</span><span class="p">[</span><span class="n">cap_key</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">light_types</span><span class="p">[</span><span class="n">cap_key</span><span class="p">].</span><span class="nf">append</span><span class="p">(</span><span class="n">light</span><span class="p">)</span>

    <span class="c1"># Print capability warnings
</span>    <span class="k">if</span> <span class="n">capability_warnings</span><span class="p">:</span>
        <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="se">\n</span><span class="s">=== Capability Warnings ===</span><span class="sh">"</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">warning</span> <span class="ow">in</span> <span class="n">capability_warnings</span><span class="p">:</span>
            <span class="nf">print</span><span class="p">(</span><span class="n">warning</span><span class="p">)</span>

    <span class="c1"># Print brightness statistics
</span>    <span class="k">if</span> <span class="n">brightness_stats</span><span class="p">[</span><span class="sh">'</span><span class="s">count</span><span class="sh">'</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="se">\n</span><span class="s">=== </span><span class="si">{</span><span class="n">group_name</span><span class="si">}</span><span class="s"> Brightness Statistics ===</span><span class="sh">"</span><span class="p">)</span>
        <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Minimum brightness: </span><span class="si">{</span><span class="n">brightness_stats</span><span class="p">[</span><span class="sh">'</span><span class="s">min</span><span class="sh">'</span><span class="p">]</span><span class="si">}</span><span class="s">%</span><span class="sh">"</span><span class="p">)</span>
        <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Maximum brightness: </span><span class="si">{</span><span class="n">brightness_stats</span><span class="p">[</span><span class="sh">'</span><span class="s">max</span><span class="sh">'</span><span class="p">]</span><span class="si">}</span><span class="s">%</span><span class="sh">"</span><span class="p">)</span>
        <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Average brightness: </span><span class="si">{</span><span class="n">brightness_stats</span><span class="p">[</span><span class="sh">'</span><span class="s">total</span><span class="sh">'</span><span class="p">]</span> <span class="o">/</span> <span class="n">brightness_stats</span><span class="p">[</span><span class="sh">'</span><span class="s">count</span><span class="sh">'</span><span class="p">]</span><span class="si">:</span><span class="p">.</span><span class="mi">1</span><span class="n">f</span><span class="si">}</span><span class="s">%</span><span class="sh">"</span><span class="p">)</span>
        <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Number of lights on: </span><span class="si">{</span><span class="n">brightness_stats</span><span class="p">[</span><span class="sh">'</span><span class="s">count</span><span class="sh">'</span><span class="p">]</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>

    <span class="c1"># Print summary of light types
</span>    <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="se">\n</span><span class="s">=== </span><span class="si">{</span><span class="n">group_name</span><span class="si">}</span><span class="s"> Light Types ===</span><span class="sh">"</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">cap_key</span><span class="p">,</span> <span class="n">lights</span> <span class="ow">in</span> <span class="n">light_types</span><span class="p">.</span><span class="nf">items</span><span class="p">():</span>
        <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="se">\n</span><span class="s">Capabilities: </span><span class="si">{</span><span class="n">cap_key</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
        <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">Lights:</span><span class="sh">"</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">light</span> <span class="ow">in</span> <span class="n">lights</span><span class="p">:</span>
            <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">  - </span><span class="si">{</span><span class="n">light</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">group_lights_by_capability</span><span class="p">(</span><span class="n">lights</span><span class="p">):</span>
    <span class="sh">"""</span><span class="s">Group lights by their capabilities.</span><span class="sh">"""</span>
    <span class="n">color_temp_lights</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">brightness_lights</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">other_lights</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">light</span> <span class="ow">in</span> <span class="n">lights</span><span class="p">:</span>
        <span class="n">state</span> <span class="o">=</span> <span class="nf">get_entity_state</span><span class="p">(</span><span class="n">light</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">state</span><span class="p">:</span>
            <span class="k">continue</span>

        <span class="n">attrs</span> <span class="o">=</span> <span class="n">state</span><span class="p">[</span><span class="sh">'</span><span class="s">attributes</span><span class="sh">'</span><span class="p">]</span>
        <span class="k">if</span> <span class="sh">'</span><span class="s">supported_color_modes</span><span class="sh">'</span> <span class="ow">in</span> <span class="n">attrs</span><span class="p">:</span>
            <span class="k">if</span> <span class="sh">'</span><span class="s">color_temp</span><span class="sh">'</span> <span class="ow">in</span> <span class="n">attrs</span><span class="p">[</span><span class="sh">'</span><span class="s">supported_color_modes</span><span class="sh">'</span><span class="p">]:</span>
                <span class="n">color_temp_lights</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">light</span><span class="p">)</span>
            <span class="k">elif</span> <span class="sh">'</span><span class="s">brightness</span><span class="sh">'</span> <span class="ow">in</span> <span class="n">attrs</span><span class="p">[</span><span class="sh">'</span><span class="s">supported_color_modes</span><span class="sh">'</span><span class="p">]:</span>
                <span class="n">brightness_lights</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">light</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">other_lights</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">light</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">other_lights</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">light</span><span class="p">)</span>

    <span class="k">return</span> <span class="p">{</span>
        <span class="sh">'</span><span class="s">Color Temperature</span><span class="sh">'</span><span class="p">:</span> <span class="n">color_temp_lights</span><span class="p">,</span>
        <span class="sh">'</span><span class="s">Brightness Only</span><span class="sh">'</span><span class="p">:</span> <span class="n">brightness_lights</span><span class="p">,</span>
        <span class="sh">'</span><span class="s">Other</span><span class="sh">'</span><span class="p">:</span> <span class="n">other_lights</span>
    <span class="p">}</span>

<span class="c1"># Main execution
</span><span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="sh">"</span><span class="s">__main__</span><span class="sh">"</span><span class="p">:</span>
    <span class="n">all_lights</span> <span class="o">=</span> <span class="nf">get_all_lights</span><span class="p">()</span>
    <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="se">\n</span><span class="s">=== All Lights Analysis ===</span><span class="sh">"</span><span class="p">)</span>
    <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Found </span><span class="si">{</span><span class="nf">len</span><span class="p">(</span><span class="n">all_lights</span><span class="p">)</span><span class="si">}</span><span class="s"> lights in total</span><span class="sh">"</span><span class="p">)</span>

    <span class="c1"># Group lights by capability
</span>    <span class="n">grouped_lights</span> <span class="o">=</span> <span class="nf">group_lights_by_capability</span><span class="p">(</span><span class="n">all_lights</span><span class="p">)</span>

    <span class="c1"># Analyze each capability group
</span>    <span class="k">for</span> <span class="n">group_name</span><span class="p">,</span> <span class="n">lights</span> <span class="ow">in</span> <span class="n">grouped_lights</span><span class="p">.</span><span class="nf">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">lights</span><span class="p">:</span>  <span class="c1"># Only analyze groups that have lights
</span>            <span class="nf">analyze_current_state</span><span class="p">(</span><span class="n">lights</span><span class="p">,</span> <span class="n">group_name</span><span class="p">)</span>
</code></pre></div></div>

<ol>
  <li><strong>Run the custom parsing script</strong> on my Home Assistant setup to produce a detailed list of bulbs and their capabilities.</li>
  <li><strong>Feed the output</strong> into Cursor (in “agent mode” or similar), along with my old configuration.</li>
  <li><strong>Have Cursor generate</strong> the updated YAML for the new Adaptive Lighting system.</li>
</ol>

<p>It’s been a huge time-saver. Sure, I still do some manual debugging, but I also use Cursor to assist with the troubleshooting. For instance, if something breaks in Home Assistant, I feed the logs into Cursor and ask it to help me fix the error. It’s surprisingly effective.</p>

<h2 id="ikea-advice">IKEA Advice</h2>

<p>After extensive testing, I’ve optimized my adaptive lighting configurations for different IKEA bulb types. Here are my recommended settings that provide smooth transitions while maintaining good visibility throughout the day.</p>

<h3 id="dimmable-white-spectrum">Dimmable white spectrum</h3>

<p>For IKEA’s <em>LED bulb GU10 345 lumen, smart/wireless dimmable white spectrum</em> bulbs.</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">adapt_brightness_standard_color_temp</span>
  <span class="na">lights</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s">light.light_1</span>
    <span class="pi">-</span> <span class="s">light.light_2</span>
  <span class="na">min_brightness</span><span class="pi">:</span> <span class="m">50</span>
  <span class="na">max_brightness</span><span class="pi">:</span> <span class="m">100</span>
  <span class="na">min_color_temp</span><span class="pi">:</span> <span class="m">2202</span>
  <span class="na">max_color_temp</span><span class="pi">:</span> <span class="m">4000</span>
  <span class="na">sleep_brightness</span><span class="pi">:</span> <span class="m">1</span>
  <span class="na">sleep_color_temp</span><span class="pi">:</span> <span class="m">2202</span>
  <span class="na">transition</span><span class="pi">:</span> <span class="m">45</span>
  <span class="na">interval</span><span class="pi">:</span> <span class="m">90</span>
  <span class="na">initial_transition</span><span class="pi">:</span> <span class="m">1</span>
  <span class="na">prefer_rgb_color</span><span class="pi">:</span> <span class="kc">false</span>
</code></pre></div></div>

<h3 id="dimmable-color-and-white-spectrum">Dimmable color and white spectrum</h3>

<p>For the <em>LED bulb E27 806 lumen, wireless dimmable color and white spectrum/globe opal white</em> bulbs.</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">adapt_brightness_extended_color_temp</span>
  <span class="na">lights</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s">light.light_3</span>
    <span class="pi">-</span> <span class="s">light.light_4</span>
  <span class="na">min_brightness</span><span class="pi">:</span> <span class="m">70</span>
  <span class="na">max_brightness</span><span class="pi">:</span> <span class="m">100</span>
  <span class="na">min_color_temp</span><span class="pi">:</span> <span class="m">2000</span>
  <span class="na">max_color_temp</span><span class="pi">:</span> <span class="m">6535</span>
  <span class="na">sleep_brightness</span><span class="pi">:</span> <span class="m">1</span>
  <span class="na">sleep_color_temp</span><span class="pi">:</span> <span class="m">2000</span>
  <span class="na">transition</span><span class="pi">:</span> <span class="m">45</span>
  <span class="na">interval</span><span class="pi">:</span> <span class="m">90</span>
  <span class="na">initial_transition</span><span class="pi">:</span> <span class="m">1</span>
  <span class="na">prefer_rgb_color</span><span class="pi">:</span> <span class="kc">false</span>
</code></pre></div></div>

<h3 id="dimmable-warm-white">Dimmable warm white</h3>

<p>For the basic <em>LED bulb GU10 345 lumen, smart/wireless dimmable warm white</em> bulbs.</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">adapt_brightness_brightness_only</span>
  <span class="na">lights</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s">light.light_5</span>
    <span class="pi">-</span> <span class="s">light.light_6</span>
  <span class="na">min_brightness</span><span class="pi">:</span> <span class="m">50</span>
  <span class="na">max_brightness</span><span class="pi">:</span> <span class="m">100</span>
  <span class="na">sleep_brightness</span><span class="pi">:</span> <span class="m">1</span>
  <span class="na">transition</span><span class="pi">:</span> <span class="m">45</span>
  <span class="na">interval</span><span class="pi">:</span> <span class="m">90</span>
  <span class="na">initial_transition</span><span class="pi">:</span> <span class="m">1</span>
</code></pre></div></div>

<h2 id="next-steps-smart-trvs">Next Steps: Smart TRVs</h2>

<p>Now that the lighting is running smoothly, my next big smart home project is upgrading all my radiators with Zigbee-based smart TRVs (thermostatic radiator valves). The goal is to have each room in my home maintain an optimal temperature by reading from the central Nest thermostat. In older British homes like mine, temperature control isn’t very granular, so having each radiator adjust itself is a major comfort and efficiency boost.</p>

<p>I’ve already purchased <a href="https://s.click.aliexpress.com/e/_EzwaYAM">these TRVs</a> but haven’t had time to configure them yet. My plan is:</p>

<ol>
  <li><strong>Pair the TRVs</strong> to my Zigbee network.</li>
  <li><strong>Pull temperature data</strong> from my Nest thermostat (the main sensor).</li>
  <li><strong>Set up automations</strong> in Home Assistant so that each room’s radiator valve opens or closes based on its own target temperature.</li>
</ol>

<p>I’m hoping this will help solve the typical British house problem: some rooms end up too warm, while others are never warm enough. With per-room heating control, it should be far more balanced and efficient.</p>

<h2 id="conclusion-so-far">Conclusion (So Far)</h2>

<p>That’s where my Home Assistant journey sits at the moment. I’m thrilled with how the adaptive lighting is working, especially now that I’ve harnessed an AI coding assistant to manage the complexity of my YAML files. The next challenge, smart radiator valves, will hopefully bring my home’s temperature control on par with my lighting automation.</p>


      <div class="mt-12 mb-8 p-8 bg-blue-50 border border-blue-100 rounded-xl">
        <h4 class="text-2xl font-semibold mb-4 text-blue-900">Enjoyed this post? Check out my podcast!</h4>
        <p class="mb-6 text-blue-800">If you found this interesting, you might enjoy <a href="/podcast" class="text-blue-600 hover:text-blue-800 underline" onclick="trackEvent('Blog CTA', 'Click', 'Podcast Link', 'How I Use Home Assistant in 2025')">"Nerding Out with Viktor"</a> - my podcast where I dive deep into tech, entrepreneurship, and security with industry experts.</p>
        <div>
          <h5 class="font-medium mb-4 text-blue-900">Listen on:</h5>
          



<div>
  <div class="flex gap-3">
    
      <a href="https://www.youtube.com/@nerdingoutwithviktor" target="_blank" rel="noopener noreferrer" onclick="trackEvent('Podcast', 'Click', 'YouTube', 'How I Use Home Assistant in 2025')">
        <img src="/assets/images/site/podcast-youtube-white.svg" alt="Listen to podcast on YouTube" />
      </a>
    
    
      <a href="https://open.spotify.com/show/7C6yipdVPWgBc6Bwikgo8g" target="_blank" rel="noopener noreferrer" onclick="trackEvent('Podcast', 'Click', 'Spotify', 'How I Use Home Assistant in 2025')">
        <img src="/assets/images/site/podcast-spotify-white.svg" alt="Listen to podcast on Spotify" />
      </a>
    
    
      <a href="https://podcasts.apple.com/us/podcast/nerding-out-with-viktor/id1722663295" target="_blank" rel="noopener noreferrer" onclick="trackEvent('Podcast', 'Click', 'Apple', 'How I Use Home Assistant in 2025')">
        <img src="/assets/images/site/podcast-apple-white.svg" alt="Listen to podcast on Apple" />
      </a>
    
    
    
      <a href="https://podcast.nerdingoutwithviktor.com/podcast_feed.xml" target="_blank" rel="noopener noreferrer" onclick="trackEvent('Podcast', 'Click', 'RSS', 'How I Use Home Assistant in 2025')">
        <img src="/assets/images/site/podcast-rss-white.svg" alt="RSS Feed" />
      </a>
    
  </div>
</div>

        </div>
      </div>

      <i>Found an error or typo? File PR against <a href="https://github.com/vpetersson/vpetersson.com/tree/master/_posts/2025-01-22-how-i-use-home-assistant-in-2025.md" rel="nofollow">this file</a>.</i>
    </article>
    <div class="mt-6">
      
  <div class="tags">
    
      <a href="/tags/home-assistant" class="tag">
        home-assistant
      </a>
    
      <a href="/tags/home-automation" class="tag">
        home-automation
      </a>
    
      <a href="/tags/smart-home" class="tag">
        smart-home
      </a>
    
      <a href="/tags/iot" class="tag">
        iot
      </a>
    
  </div>


    </div>
  </div>
</div>


    </main>
    <footer class="py-[60px] md:pt-[74px] md:pb-[40px] px-[25px] md:px-[120px] text-altPrimaryText">
  <div class="mb-[60px]">
    <a href="/">
      <img class="w-[200px] md:w-[320px]" src="/assets/images/site/logo.svg" alt="logo" />
    </a>
  </div>
  <div class="flex flex-col lg:flex-row lg:justify-between lg:items-center mb-8 lg:mb-6">
    <nav class="flex flex-col md:flex-row gap-6 md:gap-8 mb-20 lg:mb-0">
      
        <a href="/" class="">HOME</a>
      
        <a href="/about" class="">ABOUT</a>
      
        <a href="/consulting" class="">CONSULTING</a>
      
        <a href="/podcast" class="">PODCAST</a>
      
        <a href="/blog" class="">BLOG</a>
      
        <a href="https://studio.viktopia.io/" class="">VIKTOPIA STUDIO</a>
      
    </nav>
    <div class="flex gap-[13px]">
      <a href="https://twitter.com/vpetersson">
        <img src="/assets/images/site/x.svg" alt="x logo" />
      </a>
      <a href="https://github.com/vpetersson">
        <img src="/assets/images/site/github.svg" alt="github logo" />
      </a>
      <a href="https://www.linkedin.com/in/vpetersson/">
        <img src="/assets/images/site/linkedin.svg" alt="linkedIn logo" />
      </a>
    </div>
  </div>
  <hr class="mb-8 lg:mb-10 bg-[#000212] h-[3px] bg-opacity-20 border-0" />
  <div>
    <p class="font-[Inter] text-base">&copy; Viktor Petersson</p>
  </div>
</footer>

    <script src="/assets/js/main.js" defer></script>
    <script src="/assets/js/code-blocks.js" defer></script>
  </body>
</html>
